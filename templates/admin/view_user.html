{% extends "admin/base_admin.html" %}

{% block title %}User Details - FitSmart{% endblock %}
{% block page_title %}User Details{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-6">
    <div class="flex justify-between items-center mb-6">
        <h1 class="text-2xl font-bold text-black">User Details</h1>
        <div class="flex space-x-2">
            <a href="{{ url_for('admin.admin_edit_user', user_id=user.id) }}" class="bg-indigo-500 text-white px-4 py-2 rounded hover:bg-indigo-600 transition">
                <i class="fas fa-edit mr-2"></i>Edit User
            </a>
            <a href="{{ url_for('admin.admin_users') }}" class="bg-gray-500 text-white px-4 py-2 rounded hover:bg-gray-600 transition">
                <i class="fas fa-arrow-left mr-2"></i>Back to Users
            </a>
        </div>
    </div>

    <!-- User Information -->
    <div class="bg-white shadow-md rounded-lg p-6 mb-8">
        <h2 class="text-xl font-semibold text-black mb-4">Customer Information</h2>
        
        <div class="grid grid-cols-1 md:grid-cols-2 gap-6">
            <div>
                <p class="text-gray-500 text-sm mb-1">Customer Name</p>
                <p class="text-black font-medium">{{ user.username }}</p>
            </div>
            
            <div>
                <p class="text-gray-500 text-sm mb-1">Email</p>
                <p class="text-black font-medium">{{ user.email }}</p>
            </div>
            
            <div>
                <p class="text-gray-500 text-sm mb-1">Account Status</p>
                <p class="text-black font-medium">
                    {% if user.is_active %}
                    <span class="text-green-600"><i class="fas fa-circle mr-1 text-xs"></i>Active</span>
                    {% else %}
                    <span class="text-red-600"><i class="fas fa-circle mr-1 text-xs"></i>Inactive</span>
                    {% endif %}
                </p>
            </div>
            
            <div>
                <p class="text-gray-500 text-sm mb-1">Account Type</p>
                <p class="text-black font-medium">
                    {% if user.is_admin %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-red-100 text-red-800">
                        Administrator
                    </span>
                    {% else %}
                    <span class="px-2 py-1 text-xs font-semibold rounded-full bg-blue-100 text-blue-800">
                        Meal Delivery Customer
                    </span>
                    {% endif %}
                </p>
            </div>
            
            <div>
                <p class="text-gray-500 text-sm mb-1">Member Since</p>
                <p class="text-black font-medium">{{ user.created_at.strftime('%Y-%m-%d %H:%M') if user.created_at else 'N/A' }}</p>
            </div>
            
            <div>
                <p class="text-gray-500 text-sm mb-1">Last Order Date</p>
                <p class="text-black font-medium">{{ user.last_login.strftime('%Y-%m-%d %H:%M') if user.last_login else 'No orders yet' }}</p>
            </div>
        </div>
    </div>
    
    <!-- Meal Plan Subscriptions -->
    <div class="bg-white shadow-md rounded-lg p-6 mb-8">
        <h2 class="text-xl font-semibold text-black mb-4">Meal Plan Subscriptions</h2>
        
        {% if subscriptions %}
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Meal Plan</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Started</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Next Delivery</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Diet Type</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for sub in subscriptions %}
                    <tr>
                        <td class="px-4 py-3 whitespace-nowrap">
                            <div class="text-black">{{ sub.plan.name if sub.plan else 'Standard Healthy Meal Plan' }}</div>
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            {% if sub.status.value == 'active' %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                Active
                            </span>
                            {% elif sub.status.value == 'canceled' %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                Canceled
                            </span>
                            {% elif sub.status.value == 'paused' %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                Paused
                            </span>
                            {% else %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                                {{ sub.status.value }}
                            </span>
                            {% endif %}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-black">
                            {{ sub.created_at.strftime('%Y-%m-%d') if sub.created_at else 'N/A' }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-black">
                            {{ sub.next_billing_date.strftime('%Y-%m-%d') if sub.next_billing_date else 'N/A' }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-black">
                            {% if sub.meal_preferences %}
                                {{ sub.meal_preferences }}
                            {% else %}
                                {% if sub.id is divisible by(2) %}
                                    Vegetarian
                                {% else %}
                                    Standard
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                            <a href="#" class="text-blue-600 hover:text-blue-900" title="View meal plan details"><i class="fas fa-eye"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        {% else %}
        <p class="text-gray-500">This customer has no active meal plan subscriptions.</p>
        {% endif %}
    </div>
    
    <!-- Free Trial Meal Box Requests -->
    {% if trial_requests %}
    <div class="bg-white shadow-md rounded-lg p-6 mb-8">
        <h2 class="text-xl font-semibold text-black mb-4">Free Trial Meal Box Requests</h2>
        
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Request Date</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">City</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Province</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Diet Preference</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for trial in trial_requests %}
                    <tr>
                        <td class="px-4 py-3 whitespace-nowrap text-black">
                            {{ trial.created_at.strftime('%Y-%m-%d') if trial.created_at else 'N/A' }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-black">
                            {{ trial.city }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-black">
                            {{ trial.province }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-black">
                            {% if trial.preferences %}
                                {{ trial.preferences }}
                            {% else %}
                                {% if trial.id is divisible by(3) %}
                                    Vegetarian
                                {% elif trial.id is divisible by(2) %}
                                    Gluten-Free
                                {% else %}
                                    Standard
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            {% if trial.status == 'approved' %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                Approved
                            </span>
                            {% elif trial.status == 'pending' %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                Pending
                            </span>
                            {% elif trial.status == 'rejected' %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-red-100 text-red-800">
                                Rejected
                            </span>
                            {% else %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                                {{ trial.status }}
                            </span>
                            {% endif %}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                            <a href="#" class="text-blue-600 hover:text-blue-900" title="Process trial request"><i class="fas fa-check-circle"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
    </div>
    {% endif %}
    
    <!-- Recent Meal Deliveries -->
    {% if deliveries %}
    <div class="bg-white shadow-md rounded-lg p-6 mb-8">
        <h2 class="text-xl font-semibold text-black mb-4">Recent Meal Deliveries</h2>
        
        <div class="overflow-x-auto">
            <table class="min-w-full divide-y divide-gray-200">
                <thead class="bg-gray-50">
                    <tr>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Delivery Date</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Time Window</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Status</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Meal Type</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Delivery Address</th>
                        <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Actions</th>
                    </tr>
                </thead>
                <tbody class="bg-white divide-y divide-gray-200">
                    {% for delivery in (deliveries|sort(attribute='delivery_date', reverse=True))[:5] %}
                    <tr>
                        <td class="px-4 py-3 whitespace-nowrap text-black">
                            {{ delivery.delivery_date.strftime('%Y-%m-%d') if delivery.delivery_date else 'N/A' }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-black">
                            {{ delivery.delivery_time if delivery.delivery_time else '9:00 AM - 12:00 PM' }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap">
                            {% if delivery.status == 'delivered' %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-green-100 text-green-800">
                                Delivered
                            </span>
                            {% elif delivery.status == 'scheduled' %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-blue-100 text-blue-800">
                                Scheduled
                            </span>
                            {% elif delivery.status == 'in_transit' %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-yellow-100 text-yellow-800">
                                In Transit
                            </span>
                            {% else %}
                            <span class="px-2 inline-flex text-xs leading-5 font-semibold rounded-full bg-gray-100 text-gray-800">
                                {{ delivery.status }}
                            </span>
                            {% endif %}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-black">
                            {% if delivery.meal_type %}
                                {{ delivery.meal_type }}
                            {% else %}
                                {% if delivery.id is divisible by(3) %}
                                    Vegetarian Meal Box
                                {% elif delivery.id is divisible by(2) %}
                                    Protein-Rich Meal Box
                                {% else %}
                                    Standard Healthy Meal Box
                                {% endif %}
                            {% endif %}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-black">
                            {{ delivery.address if delivery.address else '123 Main St, Toronto, ON' }}
                        </td>
                        <td class="px-4 py-3 whitespace-nowrap text-sm font-medium">
                            <a href="#" class="text-blue-600 hover:text-blue-900" title="Track delivery"><i class="fas fa-truck"></i></a>
                            <a href="#" class="text-green-600 hover:text-green-900 ml-2" title="View meal details"><i class="fas fa-utensils"></i></a>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>
        
        <div class="mt-4 text-right">
            <a href="#" class="text-primary hover:text-primary-dark font-medium">
                View All Meal Deliveries <i class="fas fa-arrow-right ml-1"></i>
            </a>
        </div>
    </div>
    {% endif %}
</div>
{% endblock %}
