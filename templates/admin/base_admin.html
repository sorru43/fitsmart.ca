<!DOCTYPE html>
<html lang="en" class="dark-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <title>{% block title %}Admin Dashboard{% endblock %} - HealthyRizz</title>
    
    <!-- Favicon -->
    <link rel="icon" type="image/x-icon" href="{{ site_settings.get('site_favicon', '/static/favicon.ico') }}">
    <link rel="shortcut icon" type="image/x-icon" href="{{ site_settings.get('site_favicon', '/static/favicon.ico') }}">
    
    <!-- Tailwind CSS -->
    <script src="https://cdn.tailwindcss.com"></script>
    <script>
        tailwind.config = {
            theme: {
                extend: {
                    colors: {
                        primary: '#379777',
                        'primary-dark': '#216D55',
                        secondary: '#FFC107',
                        dark: '#151515',
                        'dark-lighter': '#252525',
                        'dark-lightest': '#333333',
                    }
                }
            }
        }
    </script>
    
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- CSRF Token Script -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Get CSRF token from meta tag
            const token = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            
            // Add CSRF token to all forms
            document.querySelectorAll('form').forEach(function(form) {
                if (!form.querySelector('input[name="csrf_token"]')) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'csrf_token';
                    input.value = token;
                    form.appendChild(input);
                }
            });
            
            // Add CSRF token to all AJAX requests
            const xhr = new XMLHttpRequest();
            const originalOpen = xhr.open;
            xhr.open = function() {
                originalOpen.apply(this, arguments);
                this.setRequestHeader('X-CSRFToken', token);
            };
        });
    </script>
    
    <style>
        /* Dark Theme Base Styles */
        body {
            background-color: #000000;
            color: #FFFFFF;
        }

        /* Sidebar Styles */
        .sidebar {
            background-color: #151515;
            border-right: 1px solid #333333;
        }

        .sidebar-link {
            color: #CCCCCC;
            transition: all 0.3s ease;
        }

        .sidebar-link:hover {
            background-color: #252525;
            color: #FFFFFF;
        }

        .sidebar-link.active {
            background-color: #379777;
            color: #FFFFFF;
        }

        /* Card and Container Styles */
        .card, .bg-white, .bg-gray-50, .bg-gray-100, .bg-gray-200, .bg-gray-300, .bg-gray-400, .bg-gray-500, .bg-gray-600, .bg-gray-700, .bg-gray-800, .bg-gray-900 {
            background-color: #151515 !important;
            border: 1px solid #333333;
            color: #FFFFFF;
        }

        /* Table Styles */
        .table, table {
            background-color: #151515;
            color: #FFFFFF;
        }

        .table th, th {
            background-color: #252525;
            color: #FFFFFF;
            border-color: #333333;
        }

        .table td, td {
            border-color: #333333;
            color: #FFFFFF;
        }

        tr:nth-child(even) {
            background-color: #1A1A1A;
        }

        /* Form Styles */
        input, select, textarea {
            background-color: #151515 !important;
            border-color: #333333 !important;
            color: #FFFFFF !important;
        }

        input::placeholder, select::placeholder, textarea::placeholder {
            color: #999999 !important;
        }

        label {
            color: #FFFFFF !important;
        }
        
        /* Button Styles */
        .btn-primary, .bg-primary {
            background-color: #379777 !important;
            color: #FFFFFF !important;
        }

        .btn-primary:hover, .bg-primary:hover {
            background-color: #216D55 !important;
        }

        .btn-secondary {
            background-color: #4B5563 !important;
            color: #FFFFFF !important;
            padding: 0.5rem 1rem;
            border-radius: 0.375rem;
            display: inline-flex;
            align-items: center;
            font-weight: 500;
            transition: all 0.2s;
        }

        .btn-secondary:hover {
            background-color: #374151 !important;
        }

        /* Form Styles */
        .form-input, .form-textarea, .form-select {
            background-color: #151515 !important;
            border: 1px solid #333333 !important;
            color: #FFFFFF !important;
            padding: 0.5rem;
            border-radius: 0.375rem;
            width: 100%;
        }

        .form-input:focus, .form-textarea:focus, .form-select:focus {
            border-color: #379777 !important;
            outline: none;
            box-shadow: 0 0 0 2px rgba(55, 151, 119, 0.2);
        }

        .form-checkbox {
            background-color: #151515 !important;
            border: 1px solid #333333 !important;
            color: #379777 !important;
            width: 1rem;
            height: 1rem;
            border-radius: 0.25rem;
        }

        .form-checkbox:checked {
            background-color: #379777 !important;
            border-color: #379777 !important;
        }
        
        /* Alert Styles */
        .alert {
            background-color: #151515;
            border: 1px solid #333333;
            color: #FFFFFF;
        }

        .alert-success {
            border-color: #379777;
            color: #4CAF50;
        }

        .alert-error {
            border-color: #DC2626;
            color: #F87171;
        }

        .alert-warning {
            border-color: #D97706;
            color: #FBBF24;
        }
        
        /* Modal Styles */
        .modal {
            background-color: rgba(0, 0, 0, 0.8);
        }
        
        .modal-content {
            background-color: #151515;
            border: 1px solid #333333;
        }
        
        .modal-header {
            border-bottom: 1px solid #333333;
            color: #FFFFFF;
        }

        .modal-footer {
            border-top: 1px solid #333333;
        }

        /* Pagination Styles */
        .pagination .page-link {
            background-color: #151515;
            border-color: #333333;
            color: #FFFFFF;
        }
        
        .pagination .page-link:hover {
            background-color: #252525;
            color: #FFFFFF;
        }
        
        .pagination .active .page-link {
            background-color: #379777;
            border-color: #379777;
            color: #FFFFFF;
        }
        
        /* Text Colors */
        .text-gray-900, .text-gray-800, .text-gray-700, .text-gray-600, .text-gray-500, .text-gray-400, .text-gray-300, .text-gray-200, .text-gray-100, .text-gray-50 {
            color: #FFFFFF !important;
        }
        
        /* Status Badge Colors */
        .bg-green-100, .bg-blue-100, .bg-yellow-100, .bg-red-100, .bg-purple-100, .bg-indigo-100, .bg-pink-100, .bg-cyan-100, .bg-amber-100 {
            background-color: #252525 !important;
        }
        
        .text-green-800, .text-blue-800, .text-yellow-800, .text-red-800, .text-purple-800, .text-indigo-800, .text-pink-800, .text-cyan-800, .text-amber-800 {
            color: #FFFFFF !important;
        }
        
        /* Custom Scrollbar */
        ::-webkit-scrollbar {
            width: 8px;
            height: 8px;
        }

        ::-webkit-scrollbar-track {
            background: #151515;
        }

        ::-webkit-scrollbar-thumb {
            background: #333333;
            border-radius: 4px;
        }

        ::-webkit-scrollbar-thumb:hover {
            background: #444444;
        }
    </style>
    {% block extra_css %}{% endblock %}
</head>
<body class="bg-black text-white">
    <!-- Mobile Menu Toggle -->
    <div class="md:hidden fixed top-0 left-0 right-0 z-50 bg-dark text-white p-3 flex justify-between items-center shadow-lg">
        <div class="flex items-center">
            {% if site_settings.site_logo %}
                <img src="{{ site_settings.site_logo }}" alt="{{ site_settings.company_name|default('HealthyRizz') }}" class="h-8 w-auto mr-2">
            {% else %}
                <span class="text-xl font-bold text-primary">{{ site_settings.company_name|default('HealthyRizz') }}</span>
            {% endif %}
            <span class="ml-2 text-sm bg-primary px-2 py-0.5 rounded text-white">Admin</span>
        </div>
        <button id="mobile-menu-toggle" class="text-white focus:outline-none" aria-label="Toggle menu">
            <i class="fas fa-bars text-xl"></i>
        </button>
    </div>

    <div class="flex flex-col md:flex-row h-screen">
        <!-- Sidebar -->
        <aside id="sidebar" class="hidden md:block md:w-64 bg-dark text-white flex-shrink-0 h-screen md:sticky md:top-0 transform transition-transform duration-300 ease-in-out -translate-x-full md:translate-x-0 fixed top-0 left-0 z-40 w-64 h-full overflow-y-auto">
            <div class="p-4 border-b border-dark-lighter hidden md:block">
                <a href="{{ url_for('admin.admin_dashboard') }}" class="flex items-center">
                    {% if site_settings.site_logo %}
                        <img src="{{ site_settings.site_logo }}" alt="{{ site_settings.company_name|default('HealthyRizz') }}" class="h-8 w-auto mr-2">
                    {% else %}
                        <span class="text-xl font-bold text-primary">{{ site_settings.company_name|default('HealthyRizz') }}</span>
                    {% endif %}
                    <span class="ml-2 text-sm bg-primary px-2 py-0.5 rounded text-white">Admin</span>
                </a>
            </div>
            
            <nav class="flex-1 p-4">
                <ul class="space-y-2">
                    <li>
                        <a href="{{ url_for('admin.admin_dashboard') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter {% if 'admin.admin_dashboard' in request.endpoint %}bg-dark-lighter{% endif %}">
                            <i class="fas fa-tachometer-alt w-6"></i>
                            <span>Dashboard</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('admin.admin_notifications') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter {% if 'admin.admin_notifications' in request.endpoint %}bg-dark-lighter{% endif %}">
                            <i class="fas fa-bell w-6"></i>
                            <span>Notifications</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('admin.admin_users') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter {% if request.endpoint == 'admin.admin_users' %}bg-dark-lighter{% endif %}">
                            <i class="fas fa-users w-6"></i>
                            <span>User Management</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('admin.admin_location_tree') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter {% if 'admin.admin_location_tree' in request.endpoint %}bg-dark-lighter{% endif %}">
                            <i class="fas fa-map-marker-alt w-6"></i>
                            <span>Delivery Locations</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('admin.admin_coupons') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter {% if 'admin.admin_coupons' in request.endpoint %}bg-dark-lighter{% endif %}">
                            <i class="fas fa-ticket-alt w-6"></i>
                            <span>Coupon Codes</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('admin.admin_banners') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter {% if 'admin.admin_banners' in request.endpoint %}bg-dark-lighter{% endif %}">
                            <i class="fas fa-bullhorn w-6"></i>
                            <span>Promotional Banners</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('admin.admin_meal_plans') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter {% if 'admin.admin_meal_plans' in request.endpoint %}bg-dark-lighter{% endif %}">
                            <i class="fas fa-utensils w-6"></i>
                            <span>Meal Plans</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('admin.admin_blog') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter {% if 'admin.admin_blog' in request.endpoint %}bg-dark-lighter{% endif %}">
                            <i class="fas fa-newspaper w-6"></i>
                            <span>Blog Management</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('admin.admin_faqs') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter {% if 'admin.admin_faqs' in request.endpoint %}bg-dark-lighter{% endif %}">
                            <i class="fas fa-question-circle w-6"></i>
                            <span>FAQs</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('admin.admin_newsletters') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter {% if 'admin.admin_newsletters' in request.endpoint %}bg-dark-lighter{% endif %}">
                            <i class="fas fa-envelope-open-text w-6"></i>
                            <span>Newsletter Subscribers</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('admin.admin_subscriptions') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter {% if 'admin.admin_subscriptions' in request.endpoint %}bg-dark-lighter{% endif %}">
                            <i class="fas fa-sync-alt w-6"></i>
                            <span>Subscriptions</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('admin.admin_orders') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter {% if 'admin.admin_orders' in request.endpoint %}bg-dark-lighter{% endif %}">
                            <i class="fas fa-truck w-6"></i>
                            <span>Daily Orders</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('admin.admin_trial_requests') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter {% if 'admin.admin_trial_requests' in request.endpoint %}bg-dark-lighter{% endif %}">
                            <i class="fas fa-flask w-6"></i>
                            <span>Trial Requests</span>
                        </a>
                    </li>
                    <li class="border-t border-dark-lighter my-2 pt-2">
                        <a href="{{ url_for('main.index') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter">
                            <i class="fas fa-globe w-6"></i>
                            <span>View Website</span>
                        </a>
                    </li>
                    <li>
                        <a href="{{ url_for('main.logout') }}" class="flex items-center p-2 rounded hover:bg-dark-lighter">
                            <i class="fas fa-sign-out-alt w-6"></i>
                            <span>Logout</span>
                        </a>
                    </li>
                </ul>
            </nav>
        </aside>
        
        <!-- Main Content -->
        <main class="flex-1 overflow-x-hidden overflow-y-auto bg-black">
            <div class="container mx-auto px-4 py-8 md:py-12">
            <!-- Navbar -->
            <header class="bg-dark shadow-sm">
                <div class="p-4 flex justify-between items-center">
                    <h1 class="text-2xl font-semibold">{% block page_title %}Dashboard{% endblock %}</h1>
                    
                    <div class="flex items-center space-x-4">
                        <span class="text-gray-300 hidden sm:inline">Welcome, Admin</span>
                    </div>
                </div>
            </header>
        
        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
          {% if messages %}
            <div class="px-4 py-2">
              {% for category, message in messages %}
                {% if category == 'error' %}
                  <div class="bg-red-900 border-l-4 border-red-500 text-red-200 p-4 mb-4" role="alert">
                    <p>{{ message }}</p>
                  </div>
                {% else %}
                  <div class="bg-green-900 border-l-4 border-green-500 text-green-200 p-4 mb-4" role="alert">
                    <p>{{ message }}</p>
                  </div>
                {% endif %}
              {% endfor %}
            </div>
          {% endif %}
        {% endwith %}
        
        <!-- Content Area -->
            <div class="flex-1 overflow-x-hidden overflow-y-auto bg-black p-6">
            {% block content %}
                {% block admin_content %}{% endblock %}
            {% endblock %}
            </div>
            </div>
        </main>
    </div>
    
    {% block scripts %}
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const mobileMenuToggle = document.getElementById('mobile-menu-toggle');
            const sidebar = document.getElementById('sidebar');
            let isMenuOpen = false;

            // Function to toggle menu
            function toggleMenu() {
                isMenuOpen = !isMenuOpen;
                if (isMenuOpen) {
                    sidebar.classList.remove('hidden');
                    sidebar.classList.remove('-translate-x-full');
                    sidebar.classList.add('translate-x-0');
                    // Add overlay
                    const overlay = document.createElement('div');
                    overlay.id = 'menu-overlay';
                    overlay.className = 'fixed inset-0 bg-black bg-opacity-50 z-30 md:hidden';
                    overlay.addEventListener('click', toggleMenu);
                    document.body.appendChild(overlay);
                    // Prevent body scroll
                    document.body.style.overflow = 'hidden';
                        } else {
                    sidebar.classList.add('-translate-x-full');
                    sidebar.classList.remove('translate-x-0');
                    // Remove overlay
                    const overlay = document.getElementById('menu-overlay');
                    if (overlay) {
                        overlay.remove();
                    }
                    // Restore body scroll
                    document.body.style.overflow = '';
                }
            }

            // Add click event listener to toggle button
            mobileMenuToggle.addEventListener('click', function(e) {
                e.stopPropagation();
                toggleMenu();
                });
                
            // Close menu when clicking outside
            document.addEventListener('click', function(event) {
                const isClickInsideSidebar = sidebar.contains(event.target);
                const isClickOnToggle = mobileMenuToggle.contains(event.target);
                    
                if (!isClickInsideSidebar && !isClickOnToggle && isMenuOpen) {
                    toggleMenu();
                }
            });
                        
            // Close menu on window resize
            window.addEventListener('resize', function() {
                if (window.innerWidth >= 768 && isMenuOpen) {
                    toggleMenu();
                    }
                });
                
            // Add touch support for mobile
            let touchStartX = 0;
            let touchEndX = 0;

            document.addEventListener('touchstart', function(event) {
                touchStartX = event.changedTouches[0].screenX;
            }, false);

            document.addEventListener('touchend', function(event) {
                touchEndX = event.changedTouches[0].screenX;
                handleSwipe();
            }, false);

            function handleSwipe() {
                const swipeThreshold = 100;
                if (touchEndX < touchStartX - swipeThreshold) {
                    // Swipe left - close menu
                    if (isMenuOpen) {
                        toggleMenu();
                    }
                } else if (touchEndX > touchStartX + swipeThreshold) {
                    // Swipe right - open menu
                    if (!isMenuOpen) {
                        toggleMenu();
                            }
                        }
            }
        });
    </script>
    {% endblock %}
</body>
</html>
