{% extends "admin/base_admin.html" %}

{% block title %}Admin Profile{% endblock %}

{% block content %}
<div class="container mx-auto px-4 py-8">
    <div class="max-w-4xl mx-auto">
        <!-- Page Header -->
        <div class="mb-8">
            <h1 class="text-3xl font-bold text-white mb-2">
                <i class="fas fa-user-cog text-primary mr-3"></i>
                Admin Profile Management
            </h1>
            <p class="text-gray-400">Manage your admin account email and password</p>
        </div>

        <!-- Flash Messages -->
        {% with messages = get_flashed_messages(with_categories=true) %}
            {% if messages %}
                {% for category, message in messages %}
                    <div class="mb-6 p-4 rounded-lg {% if category == 'error' %}bg-red-900 text-red-100 border border-red-700{% elif category == 'success' %}bg-green-900 text-green-100 border border-green-700{% else %}bg-blue-900 text-blue-100 border border-blue-700{% endif %}">
                        <div class="flex items-center">
                            <i class="fas {% if category == 'error' %}fa-exclamation-circle{% elif category == 'success' %}fa-check-circle{% else %}fa-info-circle{% endif %} mr-3"></i>
                            {{ message }}
                        </div>
                    </div>
                {% endfor %}
            {% endif %}
        {% endwith %}

        <div class="grid grid-cols-1 lg:grid-cols-2 gap-8">
            <!-- Change Email Section -->
            <div class="bg-dark-lighter rounded-lg p-6 border border-gray-700">
                <div class="flex items-center mb-6">
                    <i class="fas fa-envelope text-primary text-2xl mr-3"></i>
                    <h2 class="text-xl font-semibold text-white">Change Email Address</h2>
                </div>
                
                <form method="POST" class="space-y-4">
                    <input type="hidden" name="action" value="change_email">
                    
                    <div>
                        <label for="current_email" class="block text-sm font-medium text-gray-300 mb-2">
                            Current Email
                        </label>
                        <input type="email" id="current_email" value="{{ current_user.email }}" 
                               class="w-full px-4 py-3 bg-dark-lightest border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                               readonly>
                    </div>
                    
                    <div>
                        <label for="new_email" class="block text-sm font-medium text-gray-300 mb-2">
                            New Email Address <span class="text-red-400">*</span>
                        </label>
                        <input type="email" id="new_email" name="new_email" required
                               class="w-full px-4 py-3 bg-dark-lightest border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                               placeholder="Enter new email address">
                    </div>
                    
                    <div>
                        <label for="current_password_email" class="block text-sm font-medium text-gray-300 mb-2">
                            Current Password <span class="text-red-400">*</span>
                        </label>
                        <input type="password" id="current_password_email" name="current_password" required
                               class="w-full px-4 py-3 bg-dark-lightest border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                               placeholder="Enter current password">
                    </div>
                    
                    <button type="submit" 
                            class="w-full bg-primary hover:bg-primary-dark text-white font-semibold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-dark-lighter">
                        <i class="fas fa-save mr-2"></i>
                        Update Email Address
                    </button>
                </form>
            </div>

            <!-- Change Password Section -->
            <div class="bg-dark-lighter rounded-lg p-6 border border-gray-700">
                <div class="flex items-center mb-6">
                    <i class="fas fa-lock text-primary text-2xl mr-3"></i>
                    <h2 class="text-xl font-semibold text-white">Change Password</h2>
                </div>
                
                <form method="POST" class="space-y-4">
                    <input type="hidden" name="action" value="change_password">
                    
                    <div>
                        <label for="current_password_pass" class="block text-sm font-medium text-gray-300 mb-2">
                            Current Password <span class="text-red-400">*</span>
                        </label>
                        <input type="password" id="current_password_pass" name="current_password" required
                               class="w-full px-4 py-3 bg-dark-lightest border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                               placeholder="Enter current password">
                    </div>
                    
                    <div>
                        <label for="new_password" class="block text-sm font-medium text-gray-300 mb-2">
                            New Password <span class="text-red-400">*</span>
                        </label>
                        <input type="password" id="new_password" name="new_password" required
                               class="w-full px-4 py-3 bg-dark-lightest border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                               placeholder="Enter new password (min 6 characters)">
                    </div>
                    
                    <div>
                        <label for="confirm_password" class="block text-sm font-medium text-gray-300 mb-2">
                            Confirm New Password <span class="text-red-400">*</span>
                        </label>
                        <input type="password" id="confirm_password" name="confirm_password" required
                               class="w-full px-4 py-3 bg-dark-lightest border border-gray-600 rounded-lg text-white placeholder-gray-400 focus:outline-none focus:ring-2 focus:ring-primary focus:border-transparent"
                               placeholder="Confirm new password">
                    </div>
                    
                    <button type="submit" 
                            class="w-full bg-primary hover:bg-primary-dark text-white font-semibold py-3 px-6 rounded-lg transition duration-300 transform hover:scale-105 focus:outline-none focus:ring-2 focus:ring-primary focus:ring-offset-2 focus:ring-offset-dark-lighter">
                        <i class="fas fa-key mr-2"></i>
                        Update Password
                    </button>
                </form>
            </div>
        </div>

        <!-- Security Information -->
        <div class="mt-8 bg-dark-lighter rounded-lg p-6 border border-gray-700">
            <div class="flex items-center mb-4">
                <i class="fas fa-shield-alt text-yellow-400 text-xl mr-3"></i>
                <h3 class="text-lg font-semibold text-white">Security Information</h3>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4 text-sm text-gray-300">
                <div class="flex items-start">
                    <i class="fas fa-check-circle text-green-400 mt-1 mr-2"></i>
                    <span>Password changes require current password verification</span>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-check-circle text-green-400 mt-1 mr-2"></i>
                    <span>Email changes are validated for uniqueness</span>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-check-circle text-green-400 mt-1 mr-2"></i>
                    <span>All changes are logged for security audit</span>
                </div>
                <div class="flex items-start">
                    <i class="fas fa-check-circle text-green-400 mt-1 mr-2"></i>
                    <span>Minimum password length is 6 characters</span>
                </div>
            </div>
        </div>

        <!-- Current Account Info -->
        <div class="mt-6 bg-dark-lighter rounded-lg p-6 border border-gray-700">
            <div class="flex items-center mb-4">
                <i class="fas fa-info-circle text-blue-400 text-xl mr-3"></i>
                <h3 class="text-lg font-semibold text-white">Current Account Information</h3>
            </div>
            
            <div class="grid grid-cols-1 md:grid-cols-2 gap-4">
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Username</label>
                    <p class="text-white font-medium">{{ current_user.username }}</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Email Address</label>
                    <p class="text-white font-medium">{{ current_user.email }}</p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Account Type</label>
                    <p class="text-white font-medium">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-900 text-green-100">
                            <i class="fas fa-crown mr-1"></i>
                            Administrator
                        </span>
                    </p>
                </div>
                <div>
                    <label class="block text-sm font-medium text-gray-400 mb-1">Account Status</label>
                    <p class="text-white font-medium">
                        <span class="inline-flex items-center px-2.5 py-0.5 rounded-full text-xs font-medium bg-green-900 text-green-100">
                            <i class="fas fa-check-circle mr-1"></i>
                            Active
                        </span>
                    </p>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
document.addEventListener('DOMContentLoaded', function() {
    // Password confirmation validation
    const newPassword = document.getElementById('new_password');
    const confirmPassword = document.getElementById('confirm_password');
    
    function validatePasswordMatch() {
        if (newPassword.value && confirmPassword.value) {
            if (newPassword.value !== confirmPassword.value) {
                confirmPassword.setCustomValidity('Passwords do not match');
            } else {
                confirmPassword.setCustomValidity('');
            }
        }
    }
    
    newPassword.addEventListener('input', validatePasswordMatch);
    confirmPassword.addEventListener('input', validatePasswordMatch);
    
    // Form validation
    document.querySelectorAll('form').forEach(form => {
        form.addEventListener('submit', function(e) {
            const requiredFields = form.querySelectorAll('[required]');
            let isValid = true;
            
            requiredFields.forEach(field => {
                if (!field.value.trim()) {
                    isValid = false;
                    field.classList.add('border-red-500');
                } else {
                    field.classList.remove('border-red-500');
                }
            });
            
            if (!isValid) {
                e.preventDefault();
                alert('Please fill in all required fields.');
            }
        });
    });
});
</script>
{% endblock %} 