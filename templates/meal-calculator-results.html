{% extends 'base.html' %}

{% block title %}Your Personalized Meal Plan - Fit Smart{% endblock %}

{% block content %}
<section class="py-12 bg-black">
    <div class="container px-4 mx-auto">
        <div class="max-w-4xl mx-auto text-center mb-12">
            <h1 class="text-4xl font-bold text-white mb-4">Your Personalized Meal Plan</h1>
            <p class="text-lg text-gray-300">Based on your profile, goals, and preferences, we've calculated your nutritional needs and matched you with the perfect meal plan.</p>
        </div>
        
        <div class="max-w-5xl mx-auto bg-gray-900 rounded-lg shadow-lg overflow-hidden">
            <div class="p-6 md:p-8">
                <!-- Summary Section -->
                <div class="border-b border-gray-700 pb-6 mb-6">
                    <h2 class="text-2xl font-semibold text-white mb-4">Your Nutrition Summary</h2>
                    <div class="grid md:grid-cols-4 gap-4 mb-4">
                        <div class="bg-gray-800 rounded-lg p-4 text-center">
                            <p class="text-sm text-gray-300">Daily Calories</p>
                            <p class="text-3xl font-bold text-green-500">{{ results.adjusted_calories|int }}</p>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-4 text-center">
                            <p class="text-sm text-gray-300">Protein</p>
                            <p class="text-3xl font-bold text-green-500">{{ results.macros.protein|int }}g</p>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-4 text-center">
                            <p class="text-sm text-gray-300">Carbs</p>
                            <p class="text-3xl font-bold text-green-500">{{ results.macros.carbs|int }}g</p>
                        </div>
                        <div class="bg-gray-800 rounded-lg p-4 text-center">
                            <p class="text-sm text-gray-300">Fat</p>
                            <p class="text-3xl font-bold text-green-500">{{ results.macros.fat|int }}g</p>
                        </div>
                    </div>
                    <div class="bg-gray-800 p-4 rounded-lg">
                        <div class="flex items-start">
                            <div class="flex-shrink-0 mt-1">
                                <svg class="h-5 w-5 text-green-500" fill="currentColor" viewBox="0 0 20 20">
                                    <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                </svg>
                            </div>
                            <div class="ml-3">
                                <h3 class="text-lg font-medium text-white">Your BMI: {{ results.bmi|round(1) }} - {{ results.bmi_category }}</h3>
                                <div class="mt-2 text-sm text-gray-300">
                                    <p>Based on your height and weight, your BMI falls into the {{ results.bmi_category }} range.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>

                <!-- Recommended Meal Plan Section -->
                <div class="border-b border-gray-700 pb-6 mb-6">
                    <h2 class="text-2xl font-semibold text-white mb-4">Your Recommended Meal Plan</h2>
                    
                    {% if results.recommended_plan %}
                    <div class="bg-gray-800 border border-green-500 rounded-lg overflow-hidden mb-6">
                        <div class="bg-green-600 text-white py-3 px-4">
                            <h3 class="text-xl font-bold">{{ results.recommended_plan.name }}</h3>
                        </div>
                        <div class="p-4">
                            <p class="text-gray-300 mb-4">{{ results.recommended_plan.description }}</p>
                            
                            <div class="grid grid-cols-2 md:grid-cols-4 gap-4 mb-4">
                                <div class="text-center">
                                    <p class="text-sm text-gray-300">Calories</p>
                                    <p class="text-lg font-semibold text-white">{{ results.recommended_plan.calories }}</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-sm text-gray-300">Protein</p>
                                    <p class="text-lg font-semibold text-white">{{ results.recommended_plan.protein }}</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-sm text-gray-300">Fat</p>
                                    <p class="text-lg font-semibold text-white">{{ results.recommended_plan.fat if results.recommended_plan.fat else 'N/A' }}</p>
                                </div>
                                <div class="text-center">
                                    <p class="text-sm text-gray-300">Carbs</p>
                                    <p class="text-lg font-semibold text-white">{{ results.recommended_plan.carbs if results.recommended_plan.carbs else 'N/A' }}</p>
                                </div>
                            </div>
                            
                            <div class="flex flex-wrap gap-2 mb-4">
                                {% if results.recommended_plan.is_vegetarian %}
                                <span class="px-2 py-1 text-xs rounded-full bg-green-900 text-green-300">Vegetarian</span>
                                {% endif %}
                                
                                {% if results.recommended_plan.tag %}
                                <span class="px-2 py-1 text-xs rounded-full bg-blue-900 text-blue-300">{{ results.recommended_plan.tag }}</span>
                                {% endif %}
                                
                                {% if results.recommended_plan.includes_breakfast %}
                                <span class="px-2 py-1 text-xs rounded-full bg-purple-900 text-purple-300">Includes Breakfast</span>
                                {% endif %}
                            </div>
                            
                            <div class="flex justify-between items-center">
                                <div class="text-white">
                                    <div class="text-2xl font-bold text-primary">
                                        ${{ "%.2f"|format(results.recommended_plan.get_price_weekly(True)) }}<span class="text-sm text-gray-400 font-normal">/week</span>
                                    </div>
                                    <div class="text-sm text-gray-400">
                                        or ${{ "%.2f"|format(results.recommended_plan.get_price_monthly(True)) }}/month
                                    </div>
                                </div>
                                <a href="{{ url_for('checkout', plan_id=results.recommended_plan.id) }}" class="bg-green-600 hover:bg-green-700 text-white font-bold py-2 px-6 rounded-full transition duration-300">
                                    Choose This Plan
                                </a>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="bg-gray-800 rounded-lg p-6 text-center">
                        <p class="text-gray-300">No meal plan matches your requirements exactly. Please check our alternative options below or adjust your preferences.</p>
                    </div>
                    {% endif %}
                </div>

                <!-- View All Plans Section -->
                <div class="border-b border-gray-700 pb-6 mb-6 text-center">
                    <p class="text-gray-300 mb-4">Looking for other options? Check out our complete selection of meal plans.</p>
                    <a href="{{ url_for('meal_plans') }}" class="inline-block bg-gray-700 hover:bg-gray-600 text-white font-semibold py-3 px-6 rounded-lg transition duration-300">
                        <i class="fas fa-utensils mr-2"></i>View All Meal Plans
                    </a>
                </div>

                <!-- Lifestyle Recommendations -->
                <div class="mb-6">
                    <h2 class="text-2xl font-semibold text-white mb-4">Lifestyle Recommendations</h2>
                    <div class="bg-gray-800 rounded-lg p-6">
                        <ul class="space-y-3">
                            {% for rec in results.recommendations %}
                            <li class="flex items-start">
                                <span class="flex-shrink-0 h-5 w-5 text-green-500">
                                    <svg fill="currentColor" viewBox="0 0 20 20">
                                        <path fill-rule="evenodd" d="M10 18a8 8 0 100-16 8 8 0 000 16zm3.707-9.293a1 1 0 00-1.414-1.414L9 10.586 7.707 9.293a1 1 0 00-1.414 1.414l2 2a1 1 0 001.414 0l4-4z" clip-rule="evenodd"/>
                                    </svg>
                                </span>
                                <span class="ml-2 text-gray-300">{{ rec }}</span>
                            </li>
                            {% endfor %}
                        </ul>
                    </div>
                </div>
                
                <div class="text-center">
                    <a href="{{ url_for('meal_calculator') }}" class="inline-block bg-gray-700 hover:bg-gray-600 text-white font-semibold py-2 px-4 rounded-full mr-2 transition duration-300">
                        Recalculate
                    </a>
                    <a href="{{ url_for('meal_plans') }}" class="inline-block bg-green-600 hover:bg-green-700 text-white font-semibold py-2 px-4 rounded-full transition duration-300">
                        View All Meal Plans
                    </a>
                </div>
            </div>
        </div>
    </div>
</section>

<script>
    // You could add JavaScript here to handle any interactive elements
    document.addEventListener('DOMContentLoaded', function() {
        // Any client-side functionality can go here
    });
</script>
{% endblock %}

