{% extends 'base.html' %}

{% block title %}Complete Your Account - Fit Smart{% endblock %}

{% block content %}
<div class="bg-black py-8">
    <div class="container mx-auto px-4">
        <div class="max-w-4xl mx-auto">
            <!-- Success Message -->
            <div class="bg-gray-900 rounded-lg shadow-md overflow-hidden mb-8">
                <div class="p-8 text-center">
                    <div class="flex justify-center mb-6">
                        <div class="w-20 h-20 rounded-full bg-green-100 flex items-center justify-center">
                            <i class="fas fa-check text-primary text-3xl"></i>
                        </div>
                    </div>
                    
                    <h1 class="text-3xl font-bold mb-4 text-white">Payment Successful!</h1>
                    <p class="text-gray-300 mb-8">Your subscription has been created. Please complete your account setup to access your subscription.</p>
                </div>
            </div>
            
            <div class="grid md:grid-cols-2 gap-8">
                <!-- Subscription Details -->
                <div class="bg-gray-900 rounded-lg shadow-md overflow-hidden">
                    <div class="p-6">
                        <h2 class="text-xl font-bold mb-4 text-white">Your Subscription Details</h2>
                        
                        <div class="space-y-4">
                            <div class="flex justify-between text-gray-300">
                                <span>Meal Plan:</span>
                                <span class="font-semibold text-white">{{ plan.name }}</span>
                            </div>
                            
                            {% if subscription %}
                            <div class="flex justify-between text-gray-300">
                                <span>Frequency:</span>
                                <span class="font-semibold text-white">{{ subscription.frequency.value|capitalize }}</span>
                            </div>
                            
                            <div class="flex justify-between text-gray-300">
                                <span>First Delivery:</span>
                                <span class="font-semibold text-white">{{ subscription.current_period_start.strftime('%B %d, %Y') }}</span>
                            </div>
                            
                            <div class="flex justify-between text-gray-300">
                                <span>Amount:</span>
                                <div class="text-sm text-gray-600">
                                    <span class="font-medium">Price:</span> ₹{{ "%.2f"|format(subscription.price) }}/{{ subscription.frequency.value }}
                                </div>
                            </div>
                            
                            <div class="flex justify-between text-gray-300">
                                <span>Subscription Status:</span>
                                <span class="font-semibold text-green-500">{{ subscription.status.value|capitalize }}</span>
                            </div>
                            {% else %}
                            <div class="flex justify-between text-gray-300">
                                <span>Order Status:</span>
                                <span class="font-semibold text-green-500">Confirmed</span>
                            </div>
                            
                            <div class="flex justify-between text-gray-300">
                                <span>Amount:</span>
                                <span class="font-semibold text-white">₹{{ "%.2f"|format(order.amount) }}</span>
                            </div>
                            
                            <div class="text-yellow-500 text-sm">
                                <i class="fas fa-info-circle mr-1"></i>
                                Subscription is being processed. You'll receive confirmation shortly.
                            </div>
                            {% endif %}
                        </div>
                    </div>
                </div>
                
                <!-- Account Setup Form -->
                <div class="bg-gray-900 rounded-lg shadow-md overflow-hidden">
                    <div class="p-6">
                        <h2 class="text-xl font-bold mb-4 text-white">Complete Your Account</h2>
                        
                        <form method="POST" class="space-y-4">
                            <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                            
                            <!-- Pre-filled user details (read-only) -->
                            <div class="space-y-4">
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Full Name</label>
                                    <input type="text" value="{{ user.name }}" class="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-md text-white" readonly>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Email Address</label>
                                    <input type="email" value="{{ user.email }}" class="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-md text-white" readonly>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Phone Number</label>
                                    <input type="text" value="{{ user.phone }}" class="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-md text-white" readonly>
                                </div>
                                
                                <div>
                                    <label class="block text-sm font-medium text-gray-300 mb-2">Address</label>
                                    <input type="text" value="{{ user.address }}, {{ user.city }}, {{ user.state }} {{ user.postal_code }}" class="w-full px-3 py-2 bg-gray-800 border border-gray-700 rounded-md text-white" readonly>
                                </div>
                            </div>
                            
                            <hr class="border-gray-700 my-6">
                            
                            <!-- Password fields -->
                            <div>
                                <label for="password" class="block text-sm font-medium text-gray-300 mb-2">Create Password</label>
                                <input type="password" id="password" name="password" required 
                                       class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white focus:border-primary focus:outline-none"
                                       placeholder="Enter your password">
                                <p class="text-sm text-gray-400 mt-1">Password must be at least 6 characters long</p>
                            </div>
                            
                            <div>
                                <label for="confirm_password" class="block text-sm font-medium text-gray-300 mb-2">Confirm Password</label>
                                <input type="password" id="confirm_password" name="confirm_password" required 
                                       class="w-full px-3 py-2 bg-gray-800 border border-gray-600 rounded-md text-white focus:border-primary focus:outline-none"
                                       placeholder="Confirm your password">
                            </div>
                            
                            <button type="submit" class="w-full bg-primary hover:bg-green-600 text-white font-bold py-3 px-6 rounded-md transition">
                                Complete Account Setup
                            </button>
                        </form>
                        
                        <div class="mt-6 text-center">
                            <p class="text-sm text-gray-400">
                                Already have an account? 
                                <a href="{{ url_for('main.login') }}" class="text-primary hover:text-green-400">Login here</a>
                            </p>
                        </div>
                    </div>
                </div>
            </div>
            
            <!-- What's Next Section -->
            <div class="bg-gray-900 rounded-lg shadow-md overflow-hidden p-6 mt-8">
                <h2 class="text-xl font-bold mb-4 text-white">What's Next?</h2>
                
                <div class="space-y-6">
                    <div class="flex">
                        <div class="flex-shrink-0 mr-4">
                            <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center">
                                <span class="text-primary font-bold">1</span>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-white mb-2">Complete Your Account</h3>
                            <p class="text-gray-300">
                                Set a password to secure your account and access your subscription details.
                            </p>
                        </div>
                    </div>
                    
                    <div class="flex">
                        <div class="flex-shrink-0 mr-4">
                            <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center">
                                <span class="text-primary font-bold">2</span>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-white mb-2">Prepare for Delivery</h3>
                            <p class="text-gray-300">
                                Make sure your delivery address is accessible on your scheduled delivery day.
                                You'll receive a notification when your delivery is on its way.
                            </p>
                        </div>
                    </div>
                    
                    <div class="flex">
                        <div class="flex-shrink-0 mr-4">
                            <div class="w-10 h-10 rounded-full bg-gray-700 flex items-center justify-center">
                                <span class="text-primary font-bold">3</span>
                            </div>
                        </div>
                        <div>
                            <h3 class="text-lg font-semibold text-white mb-2">Manage Your Subscription</h3>
                            <p class="text-gray-300">
                                Once logged in, you can easily manage your subscription from your profile. 
                                Skip a delivery, change your meal plan, or update your payment details at any time.
                            </p>
                        </div>
                    </div>
                </div>
            </div>
        </div>
    </div>
</div>

<script>
// Password confirmation validation
document.getElementById('confirm_password').addEventListener('input', function() {
    const password = document.getElementById('password').value;
    const confirmPassword = this.value;
    
    if (password !== confirmPassword) {
        this.setCustomValidity('Passwords do not match');
    } else {
        this.setCustomValidity('');
    }
});

document.getElementById('password').addEventListener('input', function() {
    const confirmPassword = document.getElementById('confirm_password');
    if (confirmPassword.value) {
        if (this.value !== confirmPassword.value) {
            confirmPassword.setCustomValidity('Passwords do not match');
        } else {
            confirmPassword.setCustomValidity('');
        }
    }
});
</script>
{% endblock %} 