{% set current_url = request.path %}
{% set show_fssai_badge = site_settings.get('show_fssai_badge', 'True') %}
{% set fssai_license_number = site_settings.get('fssai_license_number', '') %}
{% set meta_description = meta_description | default('HealthyRizz - Fresh, Healthy Meal Plans in Ludhiana. Nutritionist-curated meals delivered to your doorstep.') %}
{% set og_title = og_title | default(title | default('HealthyRizz - Fresh, Healthy Meal Plans in Ludhiana')) %}
{% set og_description = og_description | default(meta_description) %}
{% set og_image = og_image | default('https://healthyrizz.in' + url_for('static', filename='images/healthy-meal-bowl.jpg')) %}
{% set twitter_title = twitter_title | default(og_title) %}
{% set twitter_description = twitter_description | default(og_description) %}
{% set twitter_image = twitter_image | default(og_image) %}
<!DOCTYPE html>
<html lang="en" class="dark-theme">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="description" content="{{ meta_description }}">
    <meta name="csrf-token" content="{{ csrf_token() }}">
    <meta http-equiv="Content-Security-Policy" content="default-src 'self'; script-src 'self' 'unsafe-inline' 'unsafe-eval'; style-src 'self' 'unsafe-inline' https://fonts.googleapis.com https://cdnjs.cloudflare.com; img-src 'self' data:; font-src 'self' data: https://fonts.gstatic.com https://cdnjs.cloudflare.com; connect-src 'self' ws: wss:;">
    
    <!-- Open Graph / Facebook -->
    <meta property="og:type" content="website">
    <meta property="og:url" content="https://healthyrizz.in{{ request.path }}">
    <meta property="og:title" content="{{ og_title }}">
    <meta property="og:description" content="{{ og_description }}">
    <meta property="og:image" content="{{ og_image }}">
    <meta property="og:site_name" content="HealthyRizz">
    <meta property="og:locale" content="en_US">
    
    <!-- Twitter -->
    <meta property="twitter:card" content="summary_large_image">
    <meta property="twitter:url" content="https://healthyrizz.in{{ request.path }}">
    <meta property="twitter:title" content="{{ twitter_title }}">
    <meta property="twitter:description" content="{{ twitter_description }}">
    <meta property="twitter:image" content="{{ twitter_image }}">
    <meta property="twitter:site" content="@healthyrizz">
    
    <!-- Additional SEO Meta Tags -->
    <meta name="author" content="HealthyRizz">
    <meta name="robots" content="index, follow">
    <meta name="googlebot" content="index, follow">
    <meta name="theme-color" content="#4CAF50">
    <meta name="msapplication-TileColor" content="#4CAF50">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    
    <!-- Canonical URL -->
    <link rel="canonical" href="https://healthyrizz.in{{ request.path }}">
    
    <title>{% block title %}HealthyRizz - Fresh, Healthy Meal Plans in Ludhiana{% endblock %}</title>
    
    <!-- Favicon -->
    <link rel="icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    <link rel="icon" href="{{ url_for('static', filename='favicon.png') }}" type="image/png">
    <link rel="shortcut icon" href="{{ url_for('static', filename='favicon.ico') }}" type="image/x-icon">
    
    <!-- Local Fonts -->
    <link rel="stylesheet" href="{{ url_for('static', filename='fonts/fonts.css') }}">
    
    <!-- CSS -->
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tailwind/tailwind.min.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/tailwind/custom-tailwind.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/style.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/animations.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/dark-theme.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/light-theme.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/meal-plans.css') }}">
    <link rel="stylesheet" href="{{ url_for('static', filename='css/subscriptions.css') }}">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    
    <!-- JSON-LD Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "Organization",
        "name": "HealthyRizz",
        "url": "https://healthyrizz.in",
        "logo": "https://healthyrizz.in{{ url_for('static', filename='images/logo white.png') }}",
        "description": "Fresh, Healthy Meal Plans in Ludhiana. Nutritionist-curated meals delivered to your doorstep.",
        "address": {
            "@type": "PostalAddress",
            "addressLocality": "Ludhiana",
            "addressRegion": "Punjab",
            "addressCountry": "IN"
        },
        "contactPoint": {
            "@type": "ContactPoint",
            "telephone": "{{ site_settings.get('contact_phone', '+91-98765-43210') }}",
            "contactType": "customer service",
            "email": "{{ site_settings.get('contact_email', 'info@healthyrizz.in') }}"
        },
        "sameAs": [
            "{{ site_settings.get('facebook_url', 'https://facebook.com/healthyrizz.in') }}",
            "{{ site_settings.get('instagram_url', 'https://instagram.com/healthyrizz.in') }}"
        ],
        "foundingDate": "2024",
        "areaServed": "Ludhiana",
        "serviceType": "Meal Delivery Service",
        "hasOfferCatalog": {
            "@type": "OfferCatalog",
            "name": "Healthy Meal Plans",
            "itemListElement": [
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Service",
                        "name": "Weekly Meal Plan",
                        "description": "Fresh, nutritious meals delivered weekly"
                    }
                },
                {
                    "@type": "Offer",
                    "itemOffered": {
                        "@type": "Service",
                        "name": "Monthly Meal Plan",
                        "description": "Comprehensive monthly nutrition program"
                    }
                }
            ]
        }
    }
    </script>
    
    <!-- Breadcrumb Structured Data -->
    <script type="application/ld+json">
    {
        "@context": "https://schema.org",
        "@type": "BreadcrumbList",
        "itemListElement": [
            {
                "@type": "ListItem",
                "position": 1,
                "name": "Home",
                "item": "https://healthyrizz.in"
            }
            {% if request.path != '/' %}
            ,{
                "@type": "ListItem",
                "position": 2,
                "name": "{{ request.path.split('/')[-1].title() if request.path.split('/')[-1] else 'Page' }}",
                "item": "https://healthyrizz.in{{ request.path }}"
            }
            {% endif %}
        ]
    }
    </script>
    
    <!-- PWA Support -->
    <link rel="manifest" href="{{ url_for('static', filename='manifest.json') }}">
    <meta name="theme-color" content="#4CAF50">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
    <meta name="apple-mobile-web-app-title" content="HealthyRizz">
    
    <!-- iOS icons -->
    <link rel="apple-touch-icon" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
    <link rel="apple-touch-icon" sizes="152x152" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
    <link rel="apple-touch-icon" sizes="180x180" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
    <link rel="apple-touch-icon" sizes="167x167" href="{{ url_for('static', filename='icons/icon-192x192.png') }}">
    
    <!-- Service Worker Registration -->
    <script src="{{ url_for('static', filename='js/register-sw.js') }}" defer></script>
    
    <!-- JavaScript for CSRF -->
    <script>
        // Add CSRF token to all forms
        document.addEventListener('DOMContentLoaded', function() {
            const token = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            document.querySelectorAll('form').forEach(function(form) {
                if (!form.querySelector('input[name="csrf_token"]')) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'csrf_token';
                    input.value = token;
                    form.appendChild(input);
                }
            });
        });
    </script>
    
    <!-- Custom Dark Theme Styles -->
    <style>
        :root {
            --color-primary: #10b981;
            --color-primary-dark: #059669;
            --color-primary-light: #34d399;
            --color-dark: #151515;
            --color-darker: #0A0A0A;
            --color-darkest: #000000;
            --color-light: #FFFFFF;
            --color-gray-100: #F5F5F5;
            --color-gray-200: #EEEEEE;
            --color-gray-300: #E0E0E0;
            --color-gray-400: #BDBDBD;
            --color-gray-500: #9E9E9E;
            --color-gray-600: #757575;
            --color-gray-700: #616161;
            --color-gray-800: #424242;
            --color-gray-900: #212121;
        }
        
        body {
            background-color: var(--color-darkest);
            color: var(--color-light);
            width: 100%;
            overflow-x: hidden;
            -webkit-text-size-adjust: 100%;
        }
        
        .bg-primary { background-color: var(--color-primary); }
        .text-primary { color: var(--color-primary); }
        .border-primary { border-color: var(--color-primary); }
        .bg-dark { background-color: var(--color-dark); }
        .bg-darker { background-color: var(--color-darker); }
        .bg-darkest { background-color: var(--color-darkest); }
        .text-light { color: var(--color-light); }
        .border-dark { border-color: var(--color-gray-800); }
        
        .hover\:bg-primary:hover { background-color: var(--color-primary-dark); }
        .hover\:text-primary:hover { color: var(--color-primary-light); }
        .hover\:border-primary:hover { border-color: var(--color-primary); }

        /* Form styles */
        input[type="text"],
        input[type="email"],
        input[type="password"],
        input[type="number"],
        input[type="tel"],
        input[type="url"],
        input[type="search"],
        input[type="date"],
        input[type="datetime-local"],
        input[type="month"],
        input[type="week"],
        input[type="time"],
        input[type="color"],
        select,
        textarea {
            background-color: var(--color-dark) !important;
            color: var(--color-light) !important;
            border: 1px solid var(--color-gray-700) !important;
            font-size: 16px; /* Prevents zoom on iOS */
            max-width: 100%;
        }

        input:focus,
        select:focus,
        textarea:focus {
            border-color: var(--color-primary) !important;
            box-shadow: 0 0 0 2px rgba(16, 185, 129, 0.25) !important;
        }

        label,
        .form-label,
        .form-text,
        .form-help,
        .form-error {
            color: var(--color-light) !important;
        }

        ::placeholder {
            color: var(--color-gray-500) !important;
            opacity: 1;
        }

        /* Navigation */
        .mobile-menu {
            display: none;
            position: absolute;
            top: 100%;
            left: 0;
            right: 0;
            background-color: var(--color-dark);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06);
            border-top: 1px solid var(--color-gray-700);
            z-index: 50;
            max-height: 80vh;
            overflow-y: auto;
            -webkit-overflow-scrolling: touch;
            transition: transform 0.3s ease-in-out, opacity 0.3s ease-in-out;
            transform: translateY(-10px);
            opacity: 0;
        }
        
        .mobile-menu.show {
            display: block !important;
            transform: translateY(0);
            opacity: 1;
        }
        
        /* Mobile menu button animations */
        .mobile-menu-button {
            transition: background-color 0.3s ease;
        }
        
        .mobile-menu-button:hover {
            background-color: var(--color-gray-800);
        }
        
        .mobile-menu-button i {
            transition: transform 0.3s ease;
        }
        
        .profile-dropdown {
            position: absolute;
            right: 0;
            top: 100%;
            z-index: 9999;
            background-color: #222;
            border: 1px solid #444;
            border-radius: 0.5rem;
            width: 200px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.7);
            padding: 0.75rem 0;
            margin-top: 0.75rem;
            pointer-events: auto !important;
            display: none;
        }
        
        .profile-dropdown.show {
            display: block !important;
        }
        
        .profile-dropdown a {
            color: #fff !important;
            padding: 0.75rem 1rem;
            display: block;
            text-decoration: none;
            transition: all 0.2s ease;
            cursor: pointer !important;
            font-weight: 500;
        }
        
        .profile-dropdown a:hover {
            background-color: var(--color-primary);
            color: #fff !important;
        }
        
        body.has-dropdown-open .profile-dropdown.show {
            display: block !important;
            visibility: visible !important;
            opacity: 1 !important;
        }
        
        /* Responsive touch-friendly adjustments */
        @media (max-width: 767px) {
            .md\:space-y-0 {
                margin-top: 0;
            }
            
            .container {
                padding-left: 1rem;
                padding-right: 1rem;
            }
            
            button, 
            [role="button"], 
            a.btn, 
            input[type="submit"], 
            .clickable {
                min-height: 44px; /* Touch-friendly size */
                min-width: 44px;
                display: inline-flex;
                align-items: center;
                justify-content: center;
            }
            
            .footer-links li {
                margin-bottom: 0.75rem;
            }
        }
    </style>
    
    <!-- Page specific CSS -->
    {% block extra_css %}{% endblock %}
    
    <!-- Global JavaScript -->
    <script>
        // Global configuration
        window.config = {
            stripePublishableKey: '{{ config.STRIPE_PUBLISHABLE_KEY }}',
            csrfToken: document.querySelector('meta[name="csrf-token"]').getAttribute('content')
        };
        
        // Add CSRF token to all AJAX requests
        document.addEventListener('DOMContentLoaded', function() {
            const token = document.querySelector('meta[name="csrf-token"]').getAttribute('content');
            const headers = new Headers();
            headers.append('X-CSRFToken', token);
            
            // Add CSRF token to all forms
            document.querySelectorAll('form').forEach(form => {
                if (!form.querySelector('input[name="csrf_token"]')) {
                    const input = document.createElement('input');
                    input.type = 'hidden';
                    input.name = 'csrf_token';
                    input.value = token;
                    form.appendChild(input);
                }
            });
        });
    </script>
    
    {% block extra_head %}{% endblock %}
</head>
<body class="flex flex-col min-h-screen bg-darkest {% block body_class %}{% endblock %}">
    <!-- Active Promotional Banner -->
    {% if banner %}
        <div id="promo-banner" class="w-full p-2 text-center text-sm sm:text-base promo-banner"
             data-bg-color="{{ banner.background_color }}" 
             data-text-color="{{ banner.text_color }}">
            {{ banner.message }}
            {% if banner.link_url and banner.link_text %}
                <a href="{{ banner.link_url }}" class="underline font-medium">{{ banner.link_text }}</a>
            {% endif %}
            <button id="close-banner" class="ml-2 text-xs rounded-full w-5 h-5 inline-flex items-center justify-center hover:bg-opacity-20 hover:bg-black focus:outline-none">
                <i class="fas fa-times"></i>
            </button>
        </div>
    {% endif %}
    
    <!-- Header -->
    <header class="bg-darker shadow-sm sticky top-0 z-30">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8">
            <div class="flex justify-between h-16 bg-darker">
                <div class="flex items-center">
                    <!-- Logo -->
                    <a href="{{ url_for('main.index') }}" class="flex-shrink-0 flex items-center group">
                        <img class="h-32 w-auto transition-transform duration-300 group-hover:scale-105" src="{{ site_settings.get('site_logo', '/static/images/logo white.png') }}" alt="HealthyRizz Logo">
                    </a>
                </div>
                
                <!-- Main Navigation - Desktop -->
                <nav class="hidden md:flex space-x-6 items-center">
                    <a href="{{ url_for('main.index') }}" class="text-white hover:text-primary py-2 {% if current_url == '/' %}text-primary font-medium border-b-2 border-primary{% endif %}">Home</a>
                    <a href="{{ url_for('main.meal_calculator') }}" class="text-white hover:text-primary py-2 {% if current_url == '/meal-calculator' %}text-primary font-medium border-b-2 border-primary{% endif %}">Meal Calculator</a>
                    <a href="{{ url_for('main.meal_plans') }}" class="text-white hover:text-primary py-2 {% if current_url == '/meal-plans' %}text-primary font-medium border-b-2 border-primary{% endif %}">Meal Plans</a>
                    <a href="{{ url_for('main.blog') }}" class="text-white hover:text-primary py-2 {% if current_url == '/blog' %}text-primary font-medium border-b-2 border-primary{% endif %}">Blog</a>
                    <a href="{{ url_for('main.index') }}#faq" class="text-white hover:text-primary py-2">FAQ</a>
                    
                    <div class="flex items-center space-x-4 pl-6 ml-6 border-l border-gray-600">
                        <a href="tel:{{ site_settings.get('contact_phone', '+919876543210') }}" class="text-white hover:text-primary" title="Call Us">
                            <i class="fas fa-phone-alt"></i>
                        </a>
                        <a href="mailto:{{ site_settings.get('contact_email', 'info@healthyrizz.in') }}" class="text-white hover:text-primary" title="Email Us">
                            <i class="fas fa-envelope"></i>
                        </a>
                        <a href="{{ site_settings.get('facebook_url', 'https://facebook.com/healthyrizz.in') }}" target="_blank" class="text-white hover:text-primary" title="Facebook">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        <a href="{{ site_settings.get('instagram_url', 'https://instagram.com/healthyrizz.in') }}" target="_blank" class="text-white hover:text-primary" title="Instagram">
                            <i class="fab fa-instagram"></i>
                        </a>
                    </div>
                </nav>
                
                <div class="flex items-center">
                    <!-- User Profile / Login -->
                    <div class="ml-4 flex items-center">
                        {% if current_user.is_authenticated %}
                            <div class="relative">
                                <div class="dropdown">
                                    <button id="profile-dropdown-toggle" 
                                            class="flex items-center space-x-1 focus:outline-none hover:text-primary cursor-pointer py-2 px-3 rounded-md hover:bg-gray-800"
                                            type="button"
                                            onclick="toggleProfileDropdown(event)">
                                        <span class="hidden md:inline text-white hover:text-primary mr-2">{{ current_user.name }}</span>
                                        <div class="h-8 w-8 rounded-full bg-primary flex items-center justify-center text-white">
                                            <i class="fas fa-user"></i>
                                        </div>
                                        <i class="fas fa-chevron-down text-xs text-white ml-1"></i>
                                    </button>
                                    <div id="profile-dropdown" class="profile-dropdown hidden absolute right-0 mt-2 w-48 bg-darker border border-gray-700 rounded-md shadow-lg py-1 z-50">
                                        <a href="{{ url_for('main.profile') }}" class="block px-4 py-2 text-sm text-white hover:bg-primary">My Profile</a>
                                        {% if current_user.is_authenticated %}
                                            <a href="{{ url_for('main.profile') }}#subscriptions" class="block px-4 py-2 text-sm text-white hover:bg-primary">My Subscriptions</a>
                                        {% endif %}
                                        <a href="{{ url_for('main.profile') }}#payments" class="block px-4 py-2 text-sm text-white hover:bg-primary">Payment History</a>
                                        <a href="{{ url_for('main.profile') }}#settings" class="block px-4 py-2 text-sm text-white hover:bg-primary">Account Settings</a>
                                        {% if current_user.is_admin %}
                                            <div class="border-t border-gray-700 my-1"></div>
                                            <a href="{{ url_for('admin.admin_dashboard') }}" class="block px-4 py-2 text-sm text-white hover:bg-primary">
                                                <i class="fas fa-user-shield mr-2"></i>Admin Dashboard
                                            </a>
                                        {% endif %}
                                        <div class="border-t border-gray-700 my-1"></div>
                                        <a href="{{ url_for('main.logout') }}" class="block px-4 py-2 text-sm text-white hover:bg-primary">Logout</a>
                                    </div>
                                </div>
                            </div>
                        {% else %}
                            <div class="flex items-center space-x-4">
                                <a href="{{ url_for('main.login') }}" class="text-white hover:text-primary">Login</a>
                                <a href="{{ url_for('main.register') }}" class="bg-primary hover:bg-primary-dark text-white px-4 py-2 rounded-md">Sign Up</a>
                            </div>
                        {% endif %}
                    </div>
                    
                    <!-- Mobile menu button -->
                    <div class="flex md:hidden ml-2">
                        <button type="button" 
                                id="mobile-menu-button" 
                                class="mobile-menu-button focus:outline-none rounded-md p-2 hover:bg-gray-800 transition-colors duration-300"
                                aria-expanded="false"
                                aria-controls="mobile-menu"
                                aria-label="Toggle navigation menu">
                            <span class="sr-only">Open main menu</span>
                            <i class="fas fa-bars text-white text-xl"></i>
                        </button>
                    </div>
                </div>
            </div>
            
            <!-- Mobile Menu -->
            <div id="mobile-menu" class="mobile-menu bg-darker" role="navigation" aria-label="Mobile navigation">
                <div class="px-4 pt-3 pb-6 space-y-3 shadow-lg border-t border-gray-700">
                    <a href="{{ url_for('main.index') }}" class="block px-4 py-3 text-light hover:bg-gray-800 rounded-md {% if current_url == '/' %}bg-primary-dark text-white font-medium{% endif %}">
                        <i class="fas fa-home mr-3 text-primary"></i>Home
                    </a>
                    <a href="{{ url_for('main.meal_calculator') }}" class="block px-4 py-3 text-light hover:bg-gray-800 rounded-md {% if current_url == '/meal-calculator' %}bg-primary-dark text-white font-medium{% endif %}">
                        <i class="fas fa-calculator mr-3 text-primary"></i>Meal Calculator
                    </a>
                    
                    <div class="relative">
                        <a href="{{ url_for('main.meal_plans') }}" class="block px-4 py-3 text-light hover:bg-gray-800 rounded-md {% if current_url == '/meal-plans' %}bg-primary-dark text-white font-medium{% endif %}">
                            <i class="fas fa-utensils mr-3 text-primary"></i>Meal Plans
                        </a>
                        <div class="pl-6 mt-1 space-y-1">
                            <a href="{{ url_for('main.meal_plans') }}?type=balanced" class="block px-4 py-2 text-light hover:bg-gray-800 rounded-md text-sm">
                                <i class="fas fa-circle text-primary text-xs mr-2"></i>Balanced Diet
                            </a>
                            <a href="{{ url_for('main.meal_plans') }}?type=weight-loss" class="block px-4 py-2 text-light hover:bg-gray-800 rounded-md text-sm">
                                <i class="fas fa-circle text-primary text-xs mr-2"></i>Weight Loss
                            </a>
                            <a href="{{ url_for('main.meal_plans') }}?type=athletic" class="block px-4 py-2 text-light hover:bg-gray-800 rounded-md text-sm">
                                <i class="fas fa-circle text-primary text-xs mr-2"></i>Athletic Performance
                            </a>
                            <a href="{{ url_for('main.meal_plans') }}?type=vegetarian" class="block px-4 py-2 text-light hover:bg-gray-800 rounded-md text-sm">
                                <i class="fas fa-circle text-primary text-xs mr-2"></i>Vegetarian
                            </a>
                            <a href="{{ url_for('main.meal_plans') }}?type=high-protein" class="block px-4 py-2 text-light hover:bg-gray-800 rounded-md text-sm">
                                <i class="fas fa-circle text-primary text-xs mr-2"></i>High Protein
                            </a>
                        </div>
                    </div>
                    
                    <a href="{{ url_for('main.blog') }}" class="block px-4 py-3 text-light hover:bg-gray-800 rounded-md {% if current_url == '/blog' %}bg-primary-dark text-white font-medium{% endif %}">
                        <i class="fas fa-newspaper mr-3 text-primary"></i>Blog
                    </a>
                    
                    <a href="{{ url_for('main.index') }}#faq" class="block px-4 py-3 text-light hover:bg-gray-800 rounded-md">
                        <i class="fas fa-question-circle mr-3 text-primary"></i>FAQ
                    </a>
                    
                    <div class="border-t border-gray-700 my-3"></div>
                    
                    <div class="border-t border-gray-700 my-3"></div>
                    
                    <!-- Mobile contact info -->
                    <div class="px-4 py-3 rounded-lg bg-gray-800 bg-opacity-50">
                        <h3 class="text-primary font-medium mb-3">Get in Touch</h3>
                        <a href="tel:{{ site_settings.get('contact_phone', '+14374283393') }}" class="flex items-center text-light mb-3 hover:text-primary">
                            <i class="fas fa-phone-alt mr-3 text-primary"></i>
                            {{ site_settings.get('contact_phone', '+1 (437) 428-3393') }}
                        </a>
                        <a href="mailto:{{ site_settings.get('contact_email', 'info@healthyrizz.ca') }}" class="flex items-center text-light mb-3 hover:text-primary">
                            <i class="fas fa-envelope mr-3 text-primary"></i>
                            {{ site_settings.get('contact_email', 'info@healthyrizz.ca') }}
                        </a>
                        <div class="flex mt-3 space-x-6">
                            <a href="{{ site_settings.get('facebook_url', 'https://facebook.com/healthyrizz.ca') }}" target="_blank" class="text-light hover:text-primary text-lg">
                                <i class="fab fa-facebook-f"></i>
                            </a>
                            <a href="{{ site_settings.get('instagram_url', 'https://instagram.com/healthyrizz.ca') }}" target="_blank" class="text-light hover:text-primary text-lg">
                                <i class="fab fa-instagram"></i>
                            </a>
                        </div>
                    </div>
                    
                    <div class="border-t border-gray-700 my-3"></div>
                    
                    <!-- Mobile login/profile -->
                    <div class="px-4 py-3">
                        {% if current_user.is_authenticated %}
                            <div class="flex items-center mb-3 bg-gray-800 rounded-lg p-3">
                                <div class="h-10 w-10 rounded-full bg-primary flex items-center justify-center text-white mr-3">
                                    <i class="fas fa-user"></i>
                                </div>
                                <div>
                                    <span class="text-light font-medium block">{{ current_user.name }}</span>
                                    <span class="text-gray-400 text-sm">{{ current_user.email }}</span>
                                </div>
                            </div>
                            <div class="space-y-1">
                                <a href="{{ url_for('main.profile') }}" class="block px-4 py-3 text-light hover:bg-gray-800 rounded-md">
                                    <i class="fas fa-user-circle mr-3 text-primary"></i>My Profile
                                </a>
                                {% if current_user.is_authenticated %}
                                    <a href="{{ url_for('main.profile') }}#subscriptions" class="block px-4 py-3 text-light hover:bg-gray-800 rounded-md">
                                        <i class="fas fa-box mr-3 text-primary"></i>My Subscriptions
                                    </a>
                                {% endif %}
                                <a href="{{ url_for('main.profile') }}#payments" class="block px-4 py-3 text-light hover:bg-gray-800 rounded-md">
                                    <i class="fas fa-credit-card mr-3 text-primary"></i>Payment History
                                </a>
                                <a href="{{ url_for('main.profile') }}#settings" class="block px-4 py-3 text-light hover:bg-gray-800 rounded-md">
                                    <i class="fas fa-cog mr-3 text-primary"></i>Account Settings
                                </a>
                                {% if current_user.is_admin %}
                                    <div class="border-t border-gray-700 my-2"></div>
                                    <a href="{{ url_for('admin.admin_dashboard') }}" class="block px-4 py-3 text-light hover:bg-gray-800 rounded-md">
                                        <i class="fas fa-user-shield mr-3 text-primary"></i>Admin Dashboard
                                    </a>
                                {% endif %}
                                <div class="border-t border-gray-700 my-2"></div>
                                <a href="{{ url_for('main.logout') }}" class="block px-4 py-3 text-light hover:bg-gray-800 rounded-md">
                                    <i class="fas fa-sign-out-alt mr-3 text-primary"></i>Logout
                                </a>
                            </div>
                        {% else %}
                            <div class="space-y-3">
                                <a href="{{ url_for('main.login') }}" class="flex items-center justify-center bg-primary hover:bg-primary-dark text-white rounded-md px-4 py-3 text-base">
                                    <i class="fas fa-sign-in-alt mr-2"></i>
                                    Log In
                                </a>
                                <a href="{{ url_for('main.register') }}" class="flex items-center justify-center border border-primary text-primary hover:bg-primary hover:text-white rounded-md px-4 py-3 text-base">
                                    <i class="fas fa-user-plus mr-2"></i>
                                    Sign Up
                                </a>
                            </div>
                        {% endif %}
                    </div>
                </div>
            </div>
        </div>
    </header>
    
    <!-- Flash Messages -->
    {% with messages = get_flashed_messages(with_categories=true) %}
        {% if messages %}
            <div class="flash-messages-container fixed top-20 right-4 z-50 space-y-2">
                {% for category, message in messages %}
                    <div class="flash-message flash-{{ category }} max-w-md bg-white border-l-4 p-4 rounded-md shadow-lg
                        {% if category == 'success' %}border-green-500 bg-green-50 text-green-800{% elif category == 'error' %}border-red-500 bg-red-50 text-red-800{% elif category == 'warning' %}border-yellow-500 bg-yellow-50 text-yellow-800{% else %}border-blue-500 bg-blue-50 text-blue-800{% endif %}">
                        <div class="flex items-start">
                            <div class="flex-shrink-0">
                                {% if category == 'success' %}
                                    <i class="fas fa-check-circle text-green-500"></i>
                                {% elif category == 'error' %}
                                    <i class="fas fa-exclamation-circle text-red-500"></i>
                                {% elif category == 'warning' %}
                                    <i class="fas fa-exclamation-triangle text-yellow-500"></i>
                                {% else %}
                                    <i class="fas fa-info-circle text-blue-500"></i>
                                {% endif %}
                            </div>
                            <div class="ml-3 flex-1">
                                <p class="text-sm font-medium">{{ message }}</p>
                            </div>
                            <div class="ml-4 flex-shrink-0">
                                <button class="flash-close inline-flex text-gray-400 hover:text-gray-600 focus:outline-none" onclick="this.parentElement.parentElement.parentElement.remove()">
                                    <i class="fas fa-times"></i>
                                </button>
                            </div>
                        </div>
                    </div>
                {% endfor %}
            </div>
            
            <!-- Auto-hide flash messages after 5 seconds -->
            <script>
                document.addEventListener('DOMContentLoaded', function() {
                    const flashMessages = document.querySelectorAll('.flash-message');
                    flashMessages.forEach(function(message) {
                        setTimeout(function() {
                            message.style.transition = 'opacity 0.5s ease-out';
                            message.style.opacity = '0';
                            setTimeout(function() {
                                if (message.parentNode) {
                                    message.parentNode.removeChild(message);
                                }
                            }, 500);
                        }, 5000); // Hide after 5 seconds
                    });
                });
            </script>
        {% endif %}
    {% endwith %}
    
    <!-- Main Content -->
    <main class="flex-grow">
        {% block content %}{% endblock %}
    </main>
    
    <!-- Footer -->
    <footer class="bg-gray-800 text-white mt-12">
        <div class="container mx-auto px-4 sm:px-6 lg:px-8 py-12">
            <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-8 gap-y-10">
                <!-- About -->
                <div>
                    <h3 class="text-lg font-medium mb-4 text-light relative">
                        <span class="relative z-10">About HealthyRizz</span>
                        <span class="absolute bottom-0 left-0 w-12 h-0.5 bg-primary"></span>
                    </h3>
                    <p class="text-gray-300 mb-4 text-sm md:text-base">{{ site_settings.get('company_tagline', 'HealthyRizz provides fresh, nutritionist-curated meal plans delivered to your doorstep in Ludhiana. We use 100% fresh ingredients to create healthy, delicious meals that help you achieve your health goals.') }}</p>
                    {% if site_settings.get('show_social_links') == 'True' %}
                    <div class="flex space-x-5 mt-6">
                        {% if site_settings.get('facebook_url') %}
                        <a href="{{ site_settings.get('facebook_url') }}" target="_blank" class="text-gray-400 hover:text-primary transition-colors duration-300 text-xl">
                            <i class="fab fa-facebook-f"></i>
                        </a>
                        {% endif %}
                        {% if site_settings.get('instagram_url') %}
                        <a href="{{ site_settings.get('instagram_url') }}" target="_blank" class="text-gray-400 hover:text-primary transition-colors duration-300 text-xl">
                            <i class="fab fa-instagram"></i>
                        </a>
                        {% endif %}
                        {% if site_settings.get('twitter_url') %}
                        <a href="{{ site_settings.get('twitter_url') }}" target="_blank" class="text-gray-400 hover:text-primary transition-colors duration-300 text-xl">
                            <i class="fab fa-twitter"></i>
                        </a>
                        {% endif %}
                        {% if site_settings.get('linkedin_url') %}
                        <a href="{{ site_settings.get('linkedin_url') }}" target="_blank" class="text-gray-400 hover:text-primary transition-colors duration-300 text-xl">
                            <i class="fab fa-linkedin"></i>
                        </a>
                        {% endif %}
                        {% if site_settings.get('youtube_url') %}
                        <a href="{{ site_settings.get('youtube_url') }}" target="_blank" class="text-gray-400 hover:text-primary transition-colors duration-300 text-xl">
                            <i class="fab fa-youtube"></i>
                        </a>
                        {% endif %}
                    </div>
                    {% endif %}
                </div>
                
                <!-- Meal Plans -->
                <div>
                    <h3 class="text-lg font-medium mb-4 text-light relative">
                        <span class="relative z-10">Meal Plans</span>
                        <span class="absolute bottom-0 left-0 w-12 h-0.5 bg-primary"></span>
                    </h3>
                    <ul class="space-y-3 footer-links">
                        <li><a href="{{ url_for('main.meal_plans') }}?type=weight-loss" class="text-gray-300 hover:text-primary transition-colors duration-300 inline-block py-1">Weight Loss</a></li>
                        <li><a href="{{ url_for('main.meal_plans') }}?type=pcod-pcos" class="text-gray-300 hover:text-primary transition-colors duration-300 inline-block py-1">PCOD/PCOS</a></li>
                        <li><a href="{{ url_for('main.meal_plans') }}?type=diabetic-friendly" class="text-gray-300 hover:text-primary transition-colors duration-300 inline-block py-1">Diabetic-Friendly</a></li>
                        <li><a href="{{ url_for('main.meal_plans') }}?type=balanced" class="text-gray-300 hover:text-primary transition-colors duration-300 inline-block py-1">Balanced Everyday</a></li>
                        <li><a href="{{ url_for('main.meal_plans') }}?type=clean-eating" class="text-gray-300 hover:text-primary transition-colors duration-300 inline-block py-1">Clean Eating</a></li>
                    </ul>
                </div>
                
                <!-- Quick Links -->
                <div>
                    <h3 class="text-lg font-medium mb-4 text-light relative">
                        <span class="relative z-10">Quick Links</span>
                        <span class="absolute bottom-0 left-0 w-12 h-0.5 bg-primary"></span>
                    </h3>
                    <ul class="space-y-3 footer-links">
                        <li><a href="{{ url_for('main.index') }}" class="text-gray-300 hover:text-primary transition-colors duration-300 inline-block py-1">Home</a></li>
                        <li><a href="{{ url_for('main.meal_calculator') }}" class="text-gray-300 hover:text-primary transition-colors duration-300 inline-block py-1">Meal Calculator</a></li>
                        <li><a href="{{ url_for('main.meal_plans') }}" class="text-gray-300 hover:text-primary transition-colors duration-300 inline-block py-1">Meal Plans</a></li>
                        <li><a href="{{ url_for('main.blog') }}" class="text-gray-300 hover:text-primary transition-colors duration-300 inline-block py-1">Blog</a></li>
                        <li><a href="{{ url_for('main.index') }}#faq" class="text-gray-300 hover:text-primary transition-colors duration-300 inline-block py-1">FAQ</a></li>
                        <li><a href="#" class="text-gray-300 hover:text-primary transition-colors duration-300 inline-block py-1">About Us</a></li>
                    </ul>
                </div>
                
                <!-- Contact Us -->
                <div>
                    <h3 class="text-lg font-medium mb-4 text-light relative">
                        <span class="relative z-10">Contact Us</span>
                        <span class="absolute bottom-0 left-0 w-12 h-0.5 bg-primary"></span>
                    </h3>
                    <ul class="space-y-4 mb-6">
                        <li class="flex items-start">
                            <i class="fas fa-phone-alt mt-1.5 mr-3 text-primary"></i>
                            <span class="text-gray-300">{{ site_settings.get('contact_phone', '+91 98765 43210') }}</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-envelope mt-1.5 mr-3 text-primary"></i>
                            <span class="text-gray-300">{{ site_settings.get('contact_email', 'info@healthyrizz.in') }}</span>
                        </li>
                        <li class="flex items-start">
                            <i class="fas fa-map-marker-alt mt-1.5 mr-3 text-primary"></i>
                            <span class="text-gray-300">{{ site_settings.get('company_address', 'Ludhiana, Punjab, India') }}</span>
                        </li>
                    </ul>
                    
                    <!-- Newsletter -->
                    <form action="{{ url_for('main.subscribe_newsletter') }}" method="post" class="mt-5">
                        <input type="hidden" name="csrf_token" value="{{ csrf_token() }}">
                        <label for="newsletter-email" class="block text-sm font-medium mb-2 text-gray-300">Subscribe to our newsletter</label>
                        <div class="flex">
                            <input type="email" id="newsletter-email" name="email" placeholder="Your email" required
                                   class="flex-grow rounded-l-md border-gray-700 bg-dark text-light focus:border-primary focus:ring focus:ring-primary focus:ring-opacity-50 px-3 py-2 text-sm">
                            <button type="submit" class="bg-primary hover:bg-primary-dark rounded-r-md text-white px-3 py-2 text-sm transition-colors duration-300">
                                <i class="fas fa-paper-plane"></i>
                            </button>
                        </div>
                    </form>
                </div>
            </div>
            
            <!-- Copyright Section -->
            <div class="border-t border-gray-700 mt-12 pt-8">
                <div class="flex flex-col md:flex-row justify-between items-center">
                    <div class="flex flex-col md:flex-row items-center space-y-4 md:space-y-0 md:space-x-6">
                        <p class="text-gray-400 text-sm">
                            &copy; {{ now.year }} HealthyRizz. All rights reserved. | Managed by <a href="https://gogroww.in" target="_blank" class="text-primary hover:text-primary-dark transition-colors duration-300">GOGROWW.IN</a>
                        </p>
                        {% if site_settings.get('show_fssai_badge') == 'True' %}
                        <!-- FSSAI Badge -->
                        <div class="flex items-center space-x-2 bg-white rounded-lg px-3 py-2 shadow-md">
                            <img src="{{ url_for('static', filename='images/FSSAI.png') }}" alt="FSSAI Logo" class="w-10 h-10 object-contain" loading="lazy">
                            <div class="text-xs">
                                <div class="font-bold text-gray-800">FSSAI</div>
                                <div class="text-gray-600">Licensed{% if site_settings.get('fssai_license_number') %}: {{ site_settings.get('fssai_license_number') }}{% endif %}</div>
                            </div>
                        </div>
                        {% endif %}

                        {% if site_settings.get('show_hygiene_badge') == 'True' %}
                        <!-- Hygiene Badge -->
                        <div class="flex items-center space-x-2 bg-white rounded-lg px-3 py-2 shadow-md">
                            <div class="w-8 h-8 bg-blue-500 rounded-full flex items-center justify-center">
                                <i class="fas fa-check-circle text-white text-sm"></i>
                            </div>
                            <div class="text-xs">
                                <div class="font-bold text-gray-800">Hygienic</div>
                                <div class="text-gray-600">{{ site_settings.get('hygiene_badge_text', '100% Hygienic') }}</div>
                            </div>
                        </div>
                        {% endif %}
                    </div>
                    
                    <div class="flex flex-wrap justify-center md:justify-end space-x-4 text-sm text-gray-400 mt-4 md:mt-0">
                        <a href="{{ url_for('main.privacy_policy') }}" class="hover:text-primary transition-colors duration-300 mb-2 md:mb-0">Privacy Policy</a>
                        <a href="{{ url_for('main.terms_of_service') }}" class="hover:text-primary transition-colors duration-300 mb-2 md:mb-0">Terms of Service</a>
                        <a href="{{ url_for('main.cancellation_refund_policy') }}" class="hover:text-primary transition-colors duration-300 mb-2 md:mb-0">Cancellation & Refund Policy</a>
                        <a href="{{ url_for('main.shipping_delivery_policy') }}" class="hover:text-primary transition-colors duration-300 mb-2 md:mb-0">Shipping & Delivery Policy</a>
                        <a href="{{ url_for('main.delivery_locations') }}" class="hover:text-primary transition-colors duration-300 mb-2 md:mb-0">Delivery Areas</a>
                    </div>
                </div>
            </div>
        </div>
    </footer>
    
    <!-- WhatsApp Floating Button -->
    {% if site_settings.get('show_whatsapp_button') == 'True' and site_settings.get('whatsapp_number') %}
    <div class="fixed bottom-6 right-6 z-50">
        <a href="https://wa.me/{{ site_settings.get('whatsapp_number').replace('+', '').replace(' ', '').replace('-', '') }}?text={{ site_settings.get('whatsapp_message', 'Hi! I\'m interested in your healthy meal plans.') | urlencode }}" 
           target="_blank" 
           class="bg-green-500 hover:bg-green-600 text-white rounded-full p-4 shadow-lg transition-all duration-300 transform hover:scale-110 flex items-center justify-center">
            <i class="fab fa-whatsapp text-2xl"></i>
        </a>
    </div>
    {% endif %}
    
    <!-- JavaScript -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
    <script src="{{ url_for('static', filename='js/testimonials.js') }}"></script>
    {% block extra_js %}{% endblock %}
    
    <!-- JavaScript for interactive elements -->
    <script>
        // Function to toggle the profile dropdown
        function toggleProfileDropdown(event) {
            event.preventDefault();
            event.stopPropagation();
            
            const dropdown = document.getElementById('profile-dropdown');
            const body = document.body;
            
            if (dropdown.classList.contains('hidden')) {
                dropdown.classList.remove('hidden');
                body.classList.add('has-dropdown-open');
                console.log("Profile dropdown shown");
            } else {
                dropdown.classList.add('hidden');
                body.classList.remove('has-dropdown-open');
                console.log("Profile dropdown hidden");
            }
        }
        
        // Close dropdown when clicking outside
        document.addEventListener('click', function(event) {
            const dropdown = document.getElementById('profile-dropdown');
            const toggle = document.getElementById('profile-dropdown-toggle');
            
            if (dropdown && toggle) {
                if (!dropdown.classList.contains('hidden') && 
                    !toggle.contains(event.target) && 
                    !dropdown.contains(event.target)) {
                    dropdown.classList.add('hidden');
                    document.body.classList.remove('has-dropdown-open');
                    console.log("Dropdown closed by outside click");
                }
            }
        });
        
        // Initialize dropdowns, mobile menu, and other interactive elements
        document.addEventListener('DOMContentLoaded', function() {
            try {
                // Note: Mobile menu is now handled by main.js to avoid duplicate handlers
                // Add the correct class to the mobile-menu-button for compatibility
                const mobileMenuButton = document.getElementById('mobile-menu-button');
                if (mobileMenuButton) {
                    mobileMenuButton.classList.add('mobile-menu-button');
                }
                
                // Initialize testimonial carousel if it exists
                if (typeof initializeTestimonialCarousel === 'function') {
                    initializeTestimonialCarousel();
                }
                
                // Initialize promotional banner if it exists
                if (typeof initializePromoBanner === 'function') {
                    initializePromoBanner();
                }
                
                // Add smooth scrolling for anchor links
                document.querySelectorAll('a[href^="#"]').forEach(anchor => {
                    anchor.addEventListener('click', function(e) {
                        const href = this.getAttribute('href');
                        
                        // Skip if it's just '#' or javascript void
                        if (href === '#' || href.includes('javascript:')) return;
                        
                        const targetElement = document.querySelector(href);
                        if (targetElement) {
                            e.preventDefault();
                            targetElement.scrollIntoView({
                                behavior: 'smooth',
                                block: 'start'
                            });
                            
                            // Close mobile menu if it's open
                            const mobileMenu = document.querySelector('.mobile-menu');
                            if (mobileMenu && mobileMenu.classList.contains('show')) {
                                mobileMenu.classList.remove('show');
                                if (mobileMenuButton) {
                                    mobileMenuButton.setAttribute('aria-expanded', 'false');
                                }
                            }
                        }
                    });
                });
                
            } catch (error) {
                console.error("Error initializing UI elements:", error);
            }
        });
    </script>
</body>
</html>

