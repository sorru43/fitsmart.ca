{# Video Carousel Section with Upload Support #}
<section class="py-20 bg-black">
  <div class="container mx-auto px-4">
    <div class="text-center mb-16">
      <h2 class="text-4xl lg:text-5xl font-bold text-white mb-4">Why Choose a Healthy Lifestyle?</h2>
      <p class="text-xl text-gray-300">Discover the transformative power of nutrition and wellness</p>
    </div>
    
    <div class="relative max-w-7xl mx-auto">
      <!-- Main Video Carousel Container -->
      <div class="flex flex-col lg:flex-row bg-gray-900 rounded-2xl shadow-2xl overflow-hidden border border-gray-700">
        
        <!-- Left Side - Video Section -->
        <div class="w-full lg:w-3/5 relative">
          <div class="video-carousel-container relative h-96 lg:h-[500px]" id="video-main-container">
            {% for video in videos %}
            <div class="video-slide absolute inset-0 transition-all duration-700 ease-in-out {% if loop.index0 == 0 %}opacity-100 z-20{% else %}opacity-0 z-10{% endif %}" data-slide="{{ loop.index0 }}">
              
              {% if video.video_type == 'upload' and video.video_file %}
                <!-- Uploaded Video -->
                <div class="relative h-full w-full group">
                  <video class="w-full h-full object-cover" 
                         poster="{{ video.thumbnail_image }}"
                         preload="metadata"
                         id="video-{{ video.id }}">
                    <source src="{{ video.video_url }}" type="video/mp4">
                    <source src="{{ video.video_url }}" type="video/webm">
                    Your browser does not support the video tag.
                  </video>
                  
                  <!-- Video Controls Overlay -->
                  <div class="absolute inset-0 bg-black bg-opacity-30 group-hover:bg-opacity-20 transition-all duration-300 flex items-center justify-center">
                    <button class="play-button bg-primary hover:bg-primary-dark text-white p-6 rounded-full shadow-2xl transform hover:scale-110 transition-all duration-300" 
                            onclick="playUploadedVideo('{{ video.id }}')">
                      <i class="fas fa-play text-2xl ml-1"></i>
                    </button>
                  </div>
                  
                  <!-- Video Info Overlay -->
                  <div class="absolute bottom-0 left-0 right-0 bg-gradient-to-t from-black via-black/70 to-transparent p-6">
                    <div class="text-white">
                      <h4 class="text-lg font-semibold mb-2">{{ video.title }}</h4>
                      <div class="flex items-center space-x-4 text-sm text-gray-300">
                        <span><i class="fas fa-upload mr-1"></i>Uploaded Video</span>
                        <span><i class="fas fa-hd-video mr-1"></i>HD Quality</span>
                      </div>
                    </div>
                  </div>
                </div>
                
              {% elif video.video_type == 'youtube' and video.youtube_id %}
                <!-- YouTube Video -->
                <div class="relative h-full w-full group">
                  <img src="{{ video.thumbnail_image }}" 
                       alt="{{ video.title }}" 
                       class="w-full h-full object-cover transition-transform duration-300 group-hover:scale-105">
                  <div class="absolute inset-0 bg-black bg-opacity-30 group-hover:bg-opacity-20 transition-all duration-300"></div>
                  <div class="absolute inset-0 flex items-center justify-center">
                    <button class="play-button bg-red-600 hover:bg-red-700 text-white p-6 rounded-full shadow-2xl transform hover:scale-110 transition-all duration-300" 
                            onclick="playYouTubeVideo('{{ video.youtube_id }}')">
                      <i class="fab fa-youtube text-2xl"></i>
                    </button>
                  </div>
                  
                  <!-- YouTube Badge -->
                  <div class="absolute top-4 left-4 bg-red-600 text-white px-2 py-1 rounded text-sm">
                    <i class="fab fa-youtube mr-1"></i>YouTube
                  </div>
                </div>
                
              {% else %}
                <!-- Fallback for videos without proper configuration -->
                <div class="relative h-full w-full flex items-center justify-center bg-gray-800">
                  <div class="text-center text-white">
                    <i class="fas fa-video text-6xl mb-4 text-gray-500"></i>
                    <h3 class="text-xl font-semibold mb-2">{{ video.title or 'Video Unavailable' }}</h3>
                    <p class="text-gray-400">Video not properly configured</p>
                  </div>
                </div>
              {% endif %}
              
            </div>
            {% endfor %}
          </div>
        </div>
        
        <!-- Right Side - Content Section -->
        <div class="w-full lg:w-2/5 flex flex-col">
          <!-- Main Content Area -->
          <div class="flex-1 p-8 lg:p-12 flex flex-col justify-center">
            <div id="video-content">
              {% for video in videos %}
              <div class="content-slide {% if loop.index0 == 0 %}block{% else %}hidden{% endif %}" data-content="{{ loop.index0 }}">
                <h3 class="text-3xl font-bold text-white mb-6 leading-tight">{{ video.title }}</h3>
                <p class="text-gray-300 text-lg leading-relaxed mb-8">{{ video.description }}</p>
                
                <!-- Video Type and Quality Info -->
                <div class="flex items-center space-x-4 mb-6">
                  {% if video.video_type == 'upload' %}
                    <span class="bg-green-600 text-white px-3 py-1 rounded-full text-sm">
                      <i class="fas fa-upload mr-1"></i>HD Upload
                    </span>
                  {% else %}
                    <span class="bg-red-600 text-white px-3 py-1 rounded-full text-sm">
                      <i class="fab fa-youtube mr-1"></i>YouTube
                    </span>
                  {% endif %}
                  <span class="text-primary font-semibold">Step {{ loop.index }}</span>
                </div>
                
                <!-- Progress Bar -->
                <div class="flex items-center space-x-4">
                  <div class="flex-1 h-1 bg-gray-700 rounded">
                    <div class="h-1 bg-primary rounded" style="width: {{ (loop.index / videos|length * 100) }}%"></div>
                  </div>
                  <span class="text-gray-400 text-sm">{{ loop.index }}/{{ videos|length }}</span>
                </div>
              </div>
              {% endfor %}
            </div>
          </div>
          
          <!-- Next Video Preview -->
          {% if videos|length > 1 %}
          <div class="border-t border-gray-700 p-6">
            <div class="flex items-center space-x-4" id="next-video-preview">
              {% for video in videos %}
              <div class="next-preview flex items-center space-x-4 {% if loop.index0 == 1 %}block{% else %}hidden{% endif %}" data-next="{{ loop.index0 }}">
                <div class="w-16 h-12 bg-gray-800 rounded-lg overflow-hidden flex-shrink-0">
                  <img src="{{ video.thumbnail_image }}" 
                       alt="{{ video.title }}" 
                       class="w-full h-full object-cover">
                </div>
                <div class="flex-1 min-w-0">
                  <p class="text-sm text-gray-400 mb-1">Next up</p>
                  <p class="text-white font-medium truncate">{{ video.title }}</p>
                  <div class="flex items-center mt-1">
                    {% if video.video_type == 'upload' %}
                      <span class="text-green-400 text-xs"><i class="fas fa-upload mr-1"></i>HD</span>
                    {% else %}
                      <span class="text-red-400 text-xs"><i class="fab fa-youtube mr-1"></i>YT</span>
                    {% endif %}
                  </div>
                </div>
                <button class="text-primary hover:text-primary-light transition-colors" onclick="nextSlide()">
                  <i class="fas fa-chevron-right"></i>
                </button>
              </div>
              {% endfor %}
            </div>
          </div>
          {% endif %}
        </div>
      </div>
      
      <!-- Navigation Arrows -->
      <button class="hidden md:block absolute left-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-75 text-white p-3 rounded-full transition-all duration-300 z-30" 
              onclick="prevSlide()">
        <i class="fas fa-chevron-left"></i>
      </button>
      <button class="hidden md:block absolute right-4 top-1/2 transform -translate-y-1/2 bg-black bg-opacity-50 hover:bg-opacity-75 text-white p-3 rounded-full transition-all duration-300 z-30" 
              onclick="nextSlide()">
        <i class="fas fa-chevron-right"></i>
      </button>
      
      <!-- Video Type Legend -->
      <div class="absolute top-4 right-4 bg-black bg-opacity-50 text-white px-4 py-2 rounded-full text-sm z-30">
        <i class="fas fa-hand-paper mr-2"></i>Swipe to explore
      </div>
    </div>
  </div>
</section>

<!-- Full Screen Video Modal for Uploaded Videos -->
<div id="video-modal" class="fixed inset-0 bg-black bg-opacity-95 z-50 hidden flex items-center justify-center p-4">
  <div class="relative w-full max-w-6xl">
    <button onclick="closeVideoModal()" class="absolute -top-12 right-0 text-white text-2xl hover:text-gray-300 z-10">
      <i class="fas fa-times"></i>
    </button>
    <video id="modal-video" class="w-full h-auto max-h-screen bg-black rounded-lg" controls autoplay>
      Your browser does not support the video tag.
    </video>
  </div>
</div>

<!-- YouTube Modal (for backward compatibility) -->
<div id="youtube-modal" class="fixed inset-0 bg-black bg-opacity-90 z-50 hidden flex items-center justify-center p-4">
  <div class="relative w-full max-w-4xl">
    <button onclick="closeYouTubeModal()" class="absolute -top-12 right-0 text-white text-2xl hover:text-gray-300">
      <i class="fas fa-times"></i>
    </button>
    <div id="youtube-player" class="w-full aspect-video bg-black rounded-lg"></div>
  </div>
</div>

<script>
// Video player functions
let currentPlayingVideo = null;

// Play uploaded video
window.playUploadedVideo = function(videoId) {
  console.log('Playing uploaded video:', videoId);
  
  const videoElement = document.getElementById('video-' + videoId);
  const modal = document.getElementById('video-modal');
  const modalVideo = document.getElementById('modal-video');
  
  if (!videoElement || !modal || !modalVideo) {
    console.error('Video elements not found');
    return;
  }
  
  // Copy video source to modal
  modalVideo.innerHTML = videoElement.innerHTML;
  modalVideo.load();
  
  // Show modal
  modal.classList.remove('hidden');
  document.body.style.overflow = 'hidden';
  
  // Play video
  modalVideo.play().catch(e => {
    console.error('Error playing video:', e);
    alert('Unable to play video. Please try again.');
    closeVideoModal();
  });
  
  currentPlayingVideo = modalVideo;
};

// Close video modal
window.closeVideoModal = function() {
  const modal = document.getElementById('video-modal');
  const modalVideo = document.getElementById('modal-video');
  
  modal.classList.add('hidden');
  document.body.style.overflow = 'auto';
  
  if (modalVideo) {
    modalVideo.pause();
    modalVideo.currentTime = 0;
  }
  
  currentPlayingVideo = null;
};

// YouTube player functions (existing)
let youtubePlayer;

window.playYouTubeVideo = function(videoId) {
  console.log('Playing YouTube video:', videoId);
  
  const modal = document.getElementById('youtube-modal');
  const playerDiv = document.getElementById('youtube-player');
  
  if (!modal || !playerDiv) {
    // Fallback to opening in new window
    window.open(`https://www.youtube.com/watch?v=${videoId}`, '_blank');
    return;
  }
  
  // Show modal
  modal.classList.remove('hidden');
  document.body.style.overflow = 'hidden';
  
  // Simple iframe approach for better compatibility
  playerDiv.innerHTML = `
    <iframe 
      width="100%" 
      height="100%" 
      src="https://www.youtube.com/embed/${videoId}?autoplay=1&rel=0&modestbranding=1" 
      title="YouTube video player" 
      frameborder="0" 
      allow="accelerometer; autoplay; clipboard-write; encrypted-media; gyroscope; picture-in-picture" 
      allowfullscreen
      style="border-radius: 8px;">
    </iframe>
  `;
};

window.closeYouTubeModal = function() {
  const modal = document.getElementById('youtube-modal');
  const playerDiv = document.getElementById('youtube-player');
  
  modal.classList.add('hidden');
  document.body.style.overflow = 'auto';
  
  // Clear the iframe to stop video
  playerDiv.innerHTML = '';
};

// Close modals on escape key
document.addEventListener('keydown', (e) => {
  if (e.key === 'Escape') {
    closeVideoModal();
    closeYouTubeModal();
  }
});

// Close modals on background click
document.getElementById('video-modal')?.addEventListener('click', (e) => {
  if (e.target.id === 'video-modal') {
    closeVideoModal();
  }
});

document.getElementById('youtube-modal')?.addEventListener('click', (e) => {
  if (e.target.id === 'youtube-modal') {
    closeYouTubeModal();
  }
});

// Pause video when carousel changes
function pauseCurrentVideo() {
  if (currentPlayingVideo) {
    currentPlayingVideo.pause();
  }
}

// Override nextSlide and prevSlide to pause videos
const originalNextSlide = window.nextSlide;
const originalPrevSlide = window.prevSlide;

if (originalNextSlide) {
  window.nextSlide = function() {
    pauseCurrentVideo();
    originalNextSlide();
  };
}

if (originalPrevSlide) {
  window.prevSlide = function() {
    pauseCurrentVideo();
    originalPrevSlide();
  };
}
</script> 